<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">M101J</title><link rel="stylesheet" href="css/hibernate-single.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body><div class="book" lang="en-US"><div class="titlepage"><div><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><div><h1 class="title"><a id="d0e2"/>M101J</h1></div><div><h2 class="subtitle">MongoDB for Java Developers</h2></div><div><div xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="authorgroup"><div class="authors">by <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">NAIF</span> (SIMASOFT)</div><div class="editors"/><div class="others"/></div></div></div><hr/></div><div class="toc"><dl><dt><span class="chapter"><a href="#mongo">1. MONGO</a></span></dt><dd><dl><dt><span class="section"><a href="#_instalar">1.1. Instalar:</a></span></dt><dt><span class="section"><a href="#_comandos">1.2. Comandos</a></span></dt><dt><span class="section"><a href="#_github">1.3. GitHub</a></span></dt><dt><span class="section"><a href="#_desarrollo_java">1.4. Desarrollo Java</a></span></dt><dt><span class="section"><a href="#_ejemplos">1.5. Ejemplos</a></span></dt><dt><span class="section"><a href="#_play_framework">1.6. Play framework</a></span></dt><dt><span class="section"><a href="#mongo-m101j">1.7. M101J: MongoDB for Java Developers</a></span></dt><dd><dl><dt><span class="section"><a href="#mongo-m101j-week1">1.7.1. WEEK 1 - INTRODUCTION</a></span></dt><dt><span class="section"><a href="#mongo-m101j-week2">1.7.2. WEEK 2 - CRUD</a></span></dt><dt><span class="section"><a href="#mongo-m101j-week3">1.7.3. WEEK 3 - SCHEMA DESIGN</a></span></dt><dt><span class="section"><a href="#mongo-m101j-week4">1.7.4. WEEK 4 - PERFORMANCE</a></span></dt><dt><span class="section"><a href="#mongo-m101j-week5">1.7.5. WEEK 5 - AGGREGATION</a></span></dt><dt><span class="section"><a href="#mongo-m101j-week6">1.7.6. WEEK 6 - APPLICATION ENGINEERING</a></span></dt><dt><span class="section"><a href="#mongo-m101j-week7">1.7.7. WEEK 7 - CASE STUDIES</a></span></dt><dt><span class="section"><a href="#mongo-m101j-final">1.7.8. FINAL EXAM</a></span></dt></dl></dd></dl></dd></dl></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="mongo"/>Chapter 1. MONGO</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_instalar">1.1. Instalar:</a></span></dt><dt><span class="section"><a href="#_comandos">1.2. Comandos</a></span></dt><dt><span class="section"><a href="#_github">1.3. GitHub</a></span></dt><dt><span class="section"><a href="#_desarrollo_java">1.4. Desarrollo Java</a></span></dt><dt><span class="section"><a href="#_ejemplos">1.5. Ejemplos</a></span></dt><dt><span class="section"><a href="#_play_framework">1.6. Play framework</a></span></dt><dt><span class="section"><a href="#mongo-m101j">1.7. M101J: MongoDB for Java Developers</a></span></dt><dd><dl><dt><span class="section"><a href="#mongo-m101j-week1">1.7.1. WEEK 1 - INTRODUCTION</a></span></dt><dt><span class="section"><a href="#mongo-m101j-week2">1.7.2. WEEK 2 - CRUD</a></span></dt><dt><span class="section"><a href="#mongo-m101j-week3">1.7.3. WEEK 3 - SCHEMA DESIGN</a></span></dt><dt><span class="section"><a href="#mongo-m101j-week4">1.7.4. WEEK 4 - PERFORMANCE</a></span></dt><dt><span class="section"><a href="#mongo-m101j-week5">1.7.5. WEEK 5 - AGGREGATION</a></span></dt><dt><span class="section"><a href="#mongo-m101j-week6">1.7.6. WEEK 6 - APPLICATION ENGINEERING</a></span></dt><dt><span class="section"><a href="#mongo-m101j-week7">1.7.7. WEEK 7 - CASE STUDIES</a></span></dt><dt><span class="section"><a href="#mongo-m101j-final">1.7.8. FINAL EXAM</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_instalar"/>1.1. Instalar:</h2></div></div></div><div class="itemizedlist"><ul><li>mongod --dbpath D:\javadat\mongodb-data\database</li><li>mongod --dbpath D:\javadat\mongodb-data\database --repair</li><li>mongodb Web Interface: <a class="ulink" href="http://localhost:28017/">http://localhost:28017/</a></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_comandos"/>1.2. Comandos</h2></div></div></div><div class="itemizedlist"><ul><li>show databases</li><li>show dbs</li><li>use test</li><li>show collections</li><li>db.custumer.find() - Muestra los registros</li><li>db.people.find().pretty() - Muestra los registros de una forma m�s legible</li><li>cur = db.people.find(); null;</li><li>db.people.count() - Cuenta los documentos</li><li>db.people.findOne( { name: "Jose David" } ) - Muestra un registro de forma aleatoria</li><li>db.custumer.remove() - Elimina los registros</li><li>db.dropDatabase() - Elimina la Base de Datos</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_github"/>1.3. GitHub</h2></div></div></div><div class="itemizedlist"><ul><li><a class="ulink" href="https://github.com/nelsonjava/mongodb">https://github.com/nelsonjava/mongodb</a></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_desarrollo_java"/>1.4. Desarrollo Java</h2></div></div></div><div class="itemizedlist"><ul><li>java -jar target/myapp-1.0-SNAPSHOT.jar</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_ejemplos"/>1.5. Ejemplos</h2></div></div></div><div class="itemizedlist"><ul><li><a class="ulink" href="https://github.com/adriannovegil/mongodb-examples">https://github.com/adriannovegil/mongodb-examples</a> - Ejemplos de uso del API Java para MongoDB</li><li><a class="ulink" href="https://github.com/alizarion/mongodb-jee">https://github.com/alizarion/mongodb-jee</a> - Ejemplos.</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_play_framework"/>1.6. Play framework</h2></div></div></div><div class="itemizedlist"><ul><li><a class="ulink" href="http://playdoces.appspot.com/">http://playdoces.appspot.com/</a></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="mongo-m101j"/>1.7. M101J: MongoDB for Java Developers</h2></div></div></div><p>About this course</p><p>Learn everything you need to know to get started building a MongoDB-based app.</p><p>This course will go over basic installation, JSON, schema design, querying, insertion of data,
indexing and working with language drivers. In the course,
you will build a blogging platform, backed by MongoDB. Our code examples will be in Java.</p><p>Prerequisites</p><p>To take this course you should be familiar with Java. Knowledge of relational databases is not required.</p><p><a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/M101J%20-%20Syllabus.465fda01fb0d.pdf">Syllabus</a></p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="mongo-m101j-week1"/>1.7.1. WEEK 1 - INTRODUCTION</h3></div></div></div><p>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_fn10crzdojk_welcome_to_m101j_ulink"/>1.7.1.1. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=FN10crzDOjk">Welcome to M101J</a></h4></div></div></div><div class="itemizedlist"><ul><li><p>Quiz: Welcome to M101J <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=ysg0vfgg6fI">Answer</a></p><div class="itemizedlist"><ul><li><p>What counts toward your final grade in the class?</p><div class="itemizedlist"><ul><li>Quizzes</li><li>Homeworks <span class="strong"><strong>OK</strong></span></li><li>Final Exam <span class="strong"><strong>OK</strong></span></li><li>Class Participation</li></ul></div></li></ul></div></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_q2ilkz1lgji_what_is_mongodb_ulink"/>1.7.1.2. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=q2iLKZ1LgjI">What is MongoDB?</a></h4></div></div></div><div class="itemizedlist"><ul><li><p>Quiz: What is MongoDB? <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=CAR42sMkXEo">Answer</a></p><div class="itemizedlist"><ul><li><p>Which of the following statements are true about MongoDB?</p><div class="itemizedlist"><ul><li>MongoDB is document oriented. <span class="strong"><strong>OK</strong></span></li><li>MongoDB supports Joins.</li><li>MongoDB has dynamic schema</li><li>MongoDB supports SQL.</li></ul></div></li></ul></div></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_iavnmgvhulw_mongo_relative_to_relational_ulink"/>1.7.1.3. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=IAvnMgvHuLw">Mongo Relative to Relational</a></h4></div></div></div><div class="itemizedlist"><ul><li><p>Quiz: Mongo Relative to Relational. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=IAvnMgvHuLw">Answer</a></p><div class="itemizedlist"><ul><li><p>Which features did MongoDB omit in order to retain scalability?</p><div class="itemizedlist"><ul><li>Joins <span class="strong"><strong>OK</strong></span></li><li>Indexes</li><li>Secondary Indexes</li><li>Transactions across multiple collections <span class="strong"><strong>OK</strong></span></li></ul></div></li></ul></div></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_swhh4q_2ttc_overview_of_building_an_app_with_mongo_ulink"/>1.7.1.4. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=swhH4q_2Ttc">Overview of Building an app with Mongo</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_f_lygamnny4_quick_introduction_to_the_mongo_shell_ulink"/>1.7.1.5. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=f-lyGAMnNY4">Quick Introduction to the Mongo Shell</a></h4></div></div></div><div class="itemizedlist"><ul><li><p>Quiz: Quick Introduction to the Mongo Shell. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=YQTqdLe3W4M">Answer</a></p><div class="itemizedlist"><ul><li><p>Which of the following expressions are valid JSON documents?</p><div class="itemizedlist"><ul><li>{a:1, b:2, c:3} <span class="strong"><strong>OK</strong></span></li><li>{a,1; b,4, c,6}</li><li>{a:1; b:1; c:4}</li><li>(A,1; b:2; c,4}</li></ul></div></li></ul></div></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_2jsjeh8q6ym_json_introduced_ulink"/>1.7.1.6. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=2jsJeH8q6YM">JSON introduced</a></h4></div></div></div><div class="itemizedlist"><ul><li><p>Quiz: JSON introduced. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=uWcOsdV4Iz4">Answer</a></p><div class="itemizedlist"><ul><li><p>Which of the following are valid JSON documents?</p><div class="itemizedlist"><ul><li>{a:1, b:2, c: 3} <span class="strong"><strong>OK</strong></span></li><li>{a:1, b:2, c:[1,2,3,4,5]}</li><li>{a:1, b:{}, c: [ { a:1, b:2}, 5, 6]}</li><li>{ }</li></ul></div></li></ul></div></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_vyz3czwyk0_system_requirements_ulink"/>1.7.1.7. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=_vYz3CZwyK0">System Requirements</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_6vfukretctg_installing_mongodb_mac_ulink"/>1.7.1.8. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=6VFukRETCTg">Installing MongoDB (mac)</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_hx5louvryoq_installing_mongodb_windows_ulink"/>1.7.1.9. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=hX5louVryOQ">Installing MongoDB (windows)</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_72vejamaypm_installing_and_using_maven_ulink"/>1.7.1.10. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=72vejAmaypM">Installing and Using Maven</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_ftyak3pmhxw_the_mongodb_java_driver_ulink"/>1.7.1.11. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=FtyaK3pMHxw">The MongoDB Java Driver</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_uh_vd_ypal8_intro_to_the_spark_web_application_framework_ulink"/>1.7.1.12. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=UH-VD_ypal8">Intro to the Spark Web Application Framework</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_8_3k2ds_ok_intro_to_the_freemarker_templating_engine_ulink"/>1.7.1.13. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=_8-3K2Ds-Ok">Intro to the Freemarker Templating Engine</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_7fdtf9alc2w_spark_and_freemarker_together_ulink"/>1.7.1.14. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=7fdtf9aLc2w">Spark and Freemarker together</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_8s5tvjaoyzg_all_together_now_mongodb_spark_and_freemarker_ulink"/>1.7.1.15. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=8S5tvJAOYzg">All together now: MongoDB, Spark, and Freemarker</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_7t1iafamuvs_spark_framework_handling_get_requests_ulink"/>1.7.1.16. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=7t1IafamuVs">Spark framework: handling GET requests</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_jzduxesy5cc_spark_framework_handling_post_requests_ulink"/>1.7.1.17. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=jZDuxesy5cc">Spark framework: handling POST requests</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_k6dlbbh_xhi_mongo_is_schemaless_ulink"/>1.7.1.18. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=K6dlBbH_XHI">Mongo is Schemaless</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_zbyccmwjgny_json_revisited_ulink"/>1.7.1.19. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=zbYCcMWJGNY">JSON Revisited</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_jkk9n6_ahvk_json_arrays_ulink"/>1.7.1.20. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=JkK9n6_ahVk">JSON Arrays</a></h4></div></div></div><div class="itemizedlist"><ul><li>Write the JSON for a simple document containing a single key "fruit" that has as its value an array containing three
strings: "apple", "pear", and "peach". <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=ciuq7XPqHKI">Answer</a></li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{fruit:["apple","pear","peach"]}</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_vryaeh3g13m_json_subdocuments_ulink"/>1.7.1.21. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=vrYAEH3g13M">JSON Subdocuments</a></h4></div></div></div><div class="itemizedlist"><ul><li>Write a JSON document with a single key, "address" that has as it value another document with the
keys <span class="emphasis"><em>street_address</em></span>, <span class="emphasis"><em>city</em></span>, <span class="emphasis"><em>state</em></span>, <span class="emphasis"><em>zipcode</em></span>, with the following values: <span class="emphasis"><em>street_address</em></span> is
 "23 Elm Drive", <span class="emphasis"><em>city</em></span> is "Palo Alto", <span class="emphasis"><em>state</em></span> is "California", <span class="emphasis"><em>zipcode</em></span> is "94305"  <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=NGp_y6BaEMw">Answer</a></li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{address:{street_address:"23 Elm Drive",city:"Palo Alto",state:"California",zipco</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_korst94_a28_json_spec_ulink"/>1.7.1.22. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=kOrsT94-A28">JSON Spec</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_epi3kdoexom_introduction_to_our_class_project_the_blog_ulink"/>1.7.1.23. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=ePi3kDoexoM">Introduction to our class project, the blog</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_bor2y9mhca0_blog_in_relational_tables_ulink"/>1.7.1.24. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=boR2y9MHCa0">Blog in Relational Tables</a></h4></div></div></div><div class="itemizedlist"><ul><li>let’s assume that our blog can be modeled with the following relational tables:</li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">authors:
	author_id,
	name,
	email,
	password

posts:
	post_id,
	author_id
	title,
	body,
	publication_date

comments:
	comment_id,
	name,
	email,
	comment_text

post_comments:
	post_id,
	comment_id


tags
	tag_id
	name

post_tags
	post_id
	tag_id</pre><div class="itemizedlist"><ul><li><p>In order to display a blog post with its comments and tags, how many tables will need to be accessed? <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=vB-4AbbLKeg">Answer</a></p><div class="itemizedlist"><ul><li>2</li><li>3</li><li>5</li><li>6 <span class="strong"><strong>OK</strong></span></li></ul></div></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_zjwczyqkvdy_blog_in_documents_ulink"/>1.7.1.25. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=ZjwCzyqKVdY">Blog in Documents</a></h4></div></div></div><div class="itemizedlist"><ul><li><p>Quiz: Blog in Documents. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=WJblHPsp1p4">Answer</a></p><div class="itemizedlist"><ul><li><p>Given the document schema that we proposed for the blog, how many collections would we need to access to display the blog home page?</p><div class="itemizedlist"><ul><li>0</li><li>1 <span class="strong"><strong>OK</strong></span></li><li>2</li><li>4</li></ul></div></li></ul></div></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_6xe3wzcpiz8_intro_to_schema_design_ulink"/>1.7.1.26. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=6XE3wZCPiZ8">Intro to Schema Design</a></h4></div></div></div><div class="itemizedlist"><ul><li><p>Quiz: Intro to Schema Design. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=wiwOEG_6ojs">Answer</a></p><div class="itemizedlist"><ul><li><p>In which scenario is it impossible to embed data within a document (you must put the data in it a separate collection). Check all that apply.</p><div class="itemizedlist"><ul><li>The data would be duplicated across multiple objects within a collection.</li><li>You need an index on the data element.</li><li>The embedded data could exceed the 16MB document limit within MongoDB <span class="strong"><strong>OK</strong></span></li><li>The data is not isomorphic.</li></ul></div></li></ul></div></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_r48n7gcdqvi_homework_1_1_ulink_ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_mempfvehjgo_answer_ulink"/>1.7.1.27. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=r48N7GcDqVI">Homework 1.1</a> <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=memPfvehjGo">Answer</a></h4></div></div></div><p>Install MongoDB on your computer and run it on the standard port.
Download the
<a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/hw1-1.957cdceb1c1e.tar">HW1 tarball (mac)</a> or
<a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/hw1-1.184820ec29b6.zip">zipfile (windows)</a>,
expand it as follows:</p><p>Mac Users:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">tar xvf hw1.tar</pre><p>Windows Users:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">You probably don't have tar installed so right click on
the hw1.zip file and choose "extract all"</pre><p>Use mongorestore to restore the dump into your running mongod. Do this by opening a
terminal window (mac) or cmd window (windows) and navigating to the directory so
that the dump directory is directly beneath you. Now type</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">mongorestore dump</pre><p>Note you will need to have your path setup correctly to find mongorestore.
Now, using the Mongo shell, perform a findone on the collection called hw1 in the database m101.
That will return one document. Please provide the value corresponding to the "answer" key from the document returned.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">42</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_homework_1_2"/>1.7.1.28. Homework 1.2</h4></div></div></div><div class="itemizedlist"><ul><li><p>Which of the following are valid JSON documents. Please choose all that apply.</p><div class="itemizedlist"><ul><li>{<span class="emphasis"><em>name</em></span>:'Fred Flintstone';'occupation':'Miner';'wife':'Wilma'}</li><li>{<span class="emphasis"><em>title</em></span>:'Star Wars', <span class="emphasis"><em>quotes</em></span>:[<span class="emphasis"><em>Use The Force</em></span>,<span class="emphasis"><em>These are not the Droids you are looking for</em></span>],<span class="emphasis"><em>director</em></span>:'George Lucas'} <span class="strong"><strong>OK</strong></span></li><li>{} <span class="strong"><strong>OK</strong></span></li><li>{<span class="emphasis"><em>city</em></span>:'New York', <span class="emphasis"><em>population</em></span>, 7999034, boros:{<span class="emphasis"><em>queens</em></span>, <span class="emphasis"><em>manhattan</em></span>, <span class="emphasis"><em>staten island</em></span>, <span class="emphasis"><em>the bronx</em></span>, <span class="emphasis"><em>brooklyn</em></span>}}</li><li>{<span class="emphasis"><em>a</em></span>:1, <span class="emphasis"><em>b</em></span>:{<span class="emphasis"><em>b</em></span>:1, <span class="emphasis"><em>c</em></span>:'foo', <span class="emphasis"><em>d</em></span>:'bar', <span class="emphasis"><em>e</em></span>:[1,2,4]}}</li></ul></div></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_homework_1_3"/>1.7.1.29. Homework 1.3</h4></div></div></div><p>Before starting this problem, you should have run mongorestore to set up your MongoDB database as described in HW1.1.</p><p>We want to test that you have a working JDK, that maven is installed and that you can run maven-based projects.
Please install JDK 1.6 or above and maven if they are not already installed. This week’s video lessons show how to install maven.</p><p>Download hw1-3.zip or hw1-3.tar, uncompress it, cd into the hw1-3 directory (there should be a pom.xml file in there), and run Maven as follows:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">mvn compile exec:java -Dexec.mainClass=com.tengen.Week1Homework3</pre><p>It requires Maven to be installed correctly, your mongod server to be running, and that you have run mongorestore properly.
If it’s working correctly, there should be two lines towards the bottom that say:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">[INFO] -------------------
[INFO] BUILD SUCCESS</pre><p>Right before those lines there should be a line that starts with:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">THE ANSWER IS:</pre><p>Type the number that appears after the colon into the box below.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">366</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_homework_1_4"/>1.7.1.30. Homework 1.4</h4></div></div></div><p>We are now going to test that you can run a Maven-based project that depends on the MongoDB Java driver,
Spark, and Freemarker. Download hw1-4.zip or hw1-4.tar, uncompress it, cd to the hw-1.4 directory, and run Maven as follows:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">mvn compile exec:java -Dexec.mainClass=com.tengen.Week1Homework4</pre><p>Like the previous homework, it requires Maven to be installed correctly, your mongod server to be running,
and that you have run mongorestore properly from HW 1.1.
If all is working correctly, there should be two lines towards the bottom that say:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">== Spark has ignited ...
&gt;&gt; Listening on 0.0.0.0:4567</pre><p>Next, open a tab in your web browser and navigate to <a class="ulink" href="http://localhost:4567/">http://localhost:4567</a>.
There should be a single line of text that starts with:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">THE ANSWER IS:</pre><p>Type the number that appears after the colon into the box below, no spaces or punctuation.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">2805</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_files_week_1"/>1.7.1.31. Files Week 1</h4></div></div></div><div class="itemizedlist"><ul><li><a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/week1-examples.tar.38e9f70c479b.gz">week1-examples.tar.gz</a></li><li><a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/week1-examples.b5fba9953936.zip">week1-examples.zip</a></li><li><a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/hw1-1.184820ec29b6.zip">hw1-1.zip</a></li><li><a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/hw1-1.957cdceb1c1e.tar">hw1-1.tar</a></li><li><a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/hw1-3.2005b1d3b047.zip">hw1-3.zip</a></li><li><a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/hw1-3.431e01c66fae.tar">hw1-3.tar</a></li><li><a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/hw1-4.b2846101dcff.zip">hw1-4.zip</a></li><li><a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/hw1-4.52e51eafad59.tar">hw1-4.tar</a></li></ul></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="mongo-m101j-week2"/>1.7.2. WEEK 2 - CRUD</h3></div></div></div><p>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_c_3vz8nb7fq_introduction_to_week_2_ulink"/>1.7.2.1. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=C-3vZ8nB7fQ">Introduction to Week 2</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_4ktdcmskx84_crud_and_the_mongo_shell_ulink"/>1.7.2.2. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=4KtdCMSKx84">CRUD and the Mongo Shell</a></h4></div></div></div><div class="itemizedlist"><ul><li><p>Quiz: CRUD and the Mongo Shell. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=lqhzCtKuJ7c">Answer</a></p><div class="itemizedlist"><ul><li><p>By the end of this week, you’ll know which of the following?</p><div class="itemizedlist"><ul><li>MongoDB’s basic document creation, retrieval, modification, and removal operations <span class="strong"><strong>OK</strong></span></li><li>Some features of the MongoDB shell, mongo <span class="strong"><strong>OK</strong></span></li><li>How to measure performance of MongoDB operations</li><li>How to manipulate MongoDB documents from Java <span class="strong"><strong>OK</strong></span></li><li>How to analyze data in MongoDB collections</li></ul></div></li></ul></div></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_hjy10xgzxzc_secrets_of_the_mongo_shell_ulink"/>1.7.2.3. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=hJy10xgZXzc">Secrets of the Mongo Shell</a></h4></div></div></div><div class="itemizedlist"><ul><li><p>Quiz: Secrets of the Mongo Shell. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=a6TFwpCoLoY">Answer</a></p><div class="itemizedlist"><ul><li>What does the following fragment of JavaScript output?</li></ul></div></li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">x = { "a" : 1 };
y = "a";
x[y]++;
print(x.a);</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">2</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_k3j6wvdw_hc_bson_introduced_ulink"/>1.7.2.4. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=K3J6WvDW-Hc">BSON Introduced</a></h4></div></div></div><div class="itemizedlist"><ul><li><p>Quiz: BSON Introduced. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=4hsTQrMs-xY">Answer</a></p><div class="itemizedlist"><ul><li><p>Which of the following are types available in BSON?</p><div class="itemizedlist"><ul><li>Strings <span class="strong"><strong>OK</strong></span></li><li>Floating-point numbers <span class="strong"><strong>OK</strong></span></li><li>Complex numbers</li><li>Arrays <span class="strong"><strong>OK</strong></span></li><li>Objects <span class="strong"><strong>OK</strong></span></li><li>Timestamps <span class="strong"><strong>OK</strong></span></li></ul></div></li></ul></div></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_rbrrvbll7qo_mongo_shell_inserting_docs_ulink"/>1.7.2.5. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=RbRRvBLl7Qo">Mongo shell, inserting docs</a></h4></div></div></div><p>Insert a document into the "fruit" collection with the attributes of
"name" being "apple", "color" being "red", and "shape" being round.
Assume that we have already issued the use command to get into the right database. Use the "insert" method.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.fruit.insert({name:"apple", color:"red", shape:"round"})</pre><p><a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=4eqpL7ETQZQ">Answer</a></p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_w9v0fjsdwbq_mongo_shell_introduction_to_findone_ulink"/>1.7.2.6. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=w9V0fJsDwbQ">Mongo shell, introduction to findOne</a></h4></div></div></div><p>Quiz: Mongo shell, introduction to findOne. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=uN_wf5a3BE4">Answer</a></p><p>Use findOne on the collection users to find one document where the key username is "dwight", and retrieve only the key named email.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.users.findOne ( { "username" : "dwight" } , { "_id" : false , "email" : true } );</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_8kkffk6a0ak_mongo_shell_introduction_to_find_ulink"/>1.7.2.7. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=8kKfFK6a0Ak">Mongo shell, introduction to find</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_uig86qjsoyy_mongo_shell_querying_using_field_selection_ulink"/>1.7.2.8. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=UIg86QjSoyY">Mongo shell, querying using field selection</a></h4></div></div></div><p>Supposing a scores collection similar to the one presented, how would you find all documents
with an essay score equal to 50 and only retrieve the student field?</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.scores.find({ type:"essay", score:50}, {student:true,_id:false});</pre><p><a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=ouHFZgtEAuU">Answer</a></p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_fhlrz4vgzkg_querying_using_gt_and_lt_ulink"/>1.7.2.9. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=FHLrz4VGzkg">Querying using $gt and $lt</a></h4></div></div></div><div class="itemizedlist"><ul><li><p>Quiz: Querying using $gt and $lt  <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=tY7I1l8JdDI">Answer</a></p><div class="itemizedlist"><ul><li><p>Which of these finds documents with a score between 50 and 60, inclusive?</p><div class="itemizedlist"><ul><li>db.scores.find({ score : { $gt : 50 , $lt : 60 } } );</li><li>db.scores.find({ score : { $gte : 50 , $lte : 60 } } );  <span class="strong"><strong>OK</strong></span></li><li>db.scores.find({ score : { $gt : 50 , $lte : 60 } } );</li><li>db.scores.find({ score : { $gte : 50 , $lt : 60 } } );</li><li>db.scores.find({ score : { $gt : 50 } } );</li></ul></div></li></ul></div></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_imcckoevu3c_inequalities_on_strings_ulink"/>1.7.2.10. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=imCCKOevU3c">Inequalities on strings</a></h4></div></div></div><div class="itemizedlist"><ul><li><p>Quiz: Inequalities on strings. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=ZRWT0lcHsoU">Answer</a></p><div class="itemizedlist"><ul><li><p>Which of the following will find all users with name between "F" and "Q"?</p><div class="itemizedlist"><ul><li>db.users.find( { name : { $gte : "F" , $lte : "Q" } } ); <span class="strong"><strong>OK</strong></span></li><li>db.users.find( { name : { $lte : "Q" , $gte : "F" } } ); <span class="strong"><strong>OK</strong></span></li><li>db.users.find( { name : { $gte : "f" , $lte : "Q" } } );</li><li>db.users.find( { name : { $lte : "Q" } });</li></ul></div></li></ul></div></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_li_jhqyf1jy_using_regexes_exists_type_ulink"/>1.7.2.11. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=lI-jhqYf1JY">Using regexes, $exists, $type</a></h4></div></div></div><p>Quiz: Using regexes, $exists, $type  <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=yMi7PwOoqXY">Answer</a></p><p>Write a query that retrieves documents from a users collection where the name has a "q" in it, and the document has an email field.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.users.find({ name : { $regex : "q" }, email : { $exists: true } } );</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_bw5elncrzps_using_or_ulink"/>1.7.2.12. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=BW5ElNCRZps">Using $or</a></h4></div></div></div><p>Quiz: Using $or  <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=diimYkvr374">Answer</a></p><p>How would you find all documents in the scores collection where the score is less than 50 or greater than 90?</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.scores.find( { $or : [ { score : { $lt : 50 } }, { score : { $gt : 90 } } ] } ) ;</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_hyk7pjgjjzc_using_and_ulink"/>1.7.2.13. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=hYk7pjgjjzc">Using $and</a></h4></div></div></div><p>Quiz: Using $and <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=oIkSajy8NLw">Answer</a></p><p>What will the following query do? [Answer]</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.scores.find( { score : { $gt : 50 }, score : { $lt : 60 } } );</pre><div class="itemizedlist"><ul><li>Find all documents with score between 50 and 60</li><li>Find all documents with score greater than 50</li><li>Find all documents with score less than 60 <span class="strong"><strong>OK</strong></span></li><li>Explode like the Death Star</li><li>None of the above</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_jveqww75bus_querying_inside_arrays_ulink"/>1.7.2.14. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=jvEqwW75Bus">Querying inside arrays</a></h4></div></div></div><p>Quiz: Querying inside arrays <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=gwECaa4N9Xc">Answer</a></p><p>Which of the following documents would be returned by this query?</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.products.find( { tags : "shiny" } );</pre><div class="itemizedlist"><ul><li>{ _id : 42 , name : "Whizzy Wiz-o-matic", tags : [ "awesome", "shiny" , "green" ] }  <span class="strong"><strong>OK</strong></span></li><li>{ _id : 704 , name : "Fooey Foo-o-tron", tags : [ "blue", "mediocre" ] }</li><li>{ _id : 1040 , name : "Snappy Snap-o-lux", tags : "shiny" } <span class="strong"><strong>OK</strong></span></li><li>{ _id : 12345 , name : "Quuxinator", tags : [ ] }</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_6o1ughwueww_using_in_and_all_ulink"/>1.7.2.15. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=6O1UGHwuEww">Using $in and $all</a></h4></div></div></div><p>Quiz: Using $in and $all  <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=6O1UGHwuEww">Answer</a></p><p>Which of the following documents matches this query?</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.users.find( { friends : { $all : [ "Joe" , "Bob" ] }, favorites : { $in : [ "running" , "pickles" ] } } )</pre><div class="itemizedlist"><ul><li>{ name : "William" , friends : [ "Bob" , "Fred" ] , favorites : [ "hamburgers", "running" ] }</li><li>{ name : "Stephen" , friends : [ "Joe" , "Pete" ] , favorites : [ "pickles", "swimming" ] }</li><li>{ name : "Cliff" , friends : [ "Pete" , "Joe" , "Tom" , "Bob" ] , favorites : [ "pickles", "cycling" ] } <span class="strong"><strong>OK</strong></span></li><li>{ name : "Harry" , friends : [ "Joe" , "Bob" ] , favorites : [ "hot dogs", "swimming" ] }</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_nrjfecifwqk_queries_with_dot_notation_ulink"/>1.7.2.16. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=NrjFECIfwqk">Queries with dot notation</a></h4></div></div></div><p>Quiz: Queries with dot notation <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=yiEjK_V008s">Answer</a></p><p>Suppose a simple e-commerce product catalog called catalog with documents that look like this:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{ product : "Super Duper-o-phonic",
  price : 100000000000,
  reviews : [ { user : "fred", comment : "Great!" , rating : 5 },
              { user : "tom" , comment : "I agree with Fred, somewhat!" , rating : 4 } ],
  ... }</pre><p>Write a query that finds all products that cost more than 10,000 and that have a rating of 5 or better.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.catalog.find( { price : { $gt : 10000 } , "reviews.rating" : { $gte : 5 } } );</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_3ja6ifsejoi_querying_cursors_ulink"/>1.7.2.17. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=3jA6iFSEJOI">Querying, cursors</a></h4></div></div></div><p>Quiz: Querying, cursors <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=djzpK7UIO94">Answer</a></p><p>Recall the documents in the scores collection:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
	"_id" : ObjectId("50844162cb4cf4564b4694f8"),
	"student" : 0,
	"type" : "exam",
	"score" : 75
}</pre><p>Write a query that retrieves exam documents, sorted by score in descending order, skipping the first 50 and showing only the next 20.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.scores.find( { type : "exam" } ).sort( { score : -1 } ).skip(50).limit(20)</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_ekd5bvmnqmi_counting_results_ulink"/>1.7.2.18. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=eKD5bVmNQMI">Counting results</a></h4></div></div></div><p>Quiz: Counting results. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=Uozp0diXOc8">Answer</a></p><p>How would you count the documents in the scores collection where the type was "essay" and the score was greater than 90?</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.scores.count({ type:"essay", score:{$gt:90}});</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_ebck6w7x_oy_wholesale_updating_of_a_document_ulink"/>1.7.2.19. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=EBCk6W7x-OY">Wholesale Updating of a Document</a></h4></div></div></div><p>Quiz: Wholesale Updating of a Document. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=pwnRUdtI8lY">Answer</a></p><p>Let’s say you had a collection with the following document in it:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{ "_id" : "Texas", "population" : 2500000, "land_locked" : 1 }</pre><p>and you issued the query:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.foo.update({_id:"Texas"},{population:30000000})</pre><p>What would be the state of the collection after the update?</p><div class="itemizedlist"><ul><li>{ "_id" : "Texas", "population" : 2500000, "land_locked" : 1 }</li><li>{ "_id" : "Texas", "population" : 3000000, "land_locked" : 1 }</li><li>{ "_id" : "Texas", "population" : 30000000 } <span class="strong"><strong>OK</strong></span></li><li>{ "_id" : ObjectId("507b7c601eb13126c9e3dcca"), "population" : 2500000 }</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_9imx2kxyad8_using_the_set_command_ulink"/>1.7.2.20. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=9iMX2KxYAd8">Using the $set command</a></h4></div></div></div><p>Quiz: Using the $set command. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=F6ZY_VVAXZ8">Answer</a></p><p>Given the document</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{'username':'splunker', 'country':'US', 'phone':'718-343-3433'}</pre><p>in the collection users, write the shell command for updating the country to <span class="emphasis"><em>RU</em></span> for only this user.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.users.update({'username':'splunker'},{$set:{'country':'RU'}})</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_kxd4mxbex_i_using_the_unset_command_ulink"/>1.7.2.21. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=Kxd4MXBEx-I">Using the $unset command</a></h4></div></div></div><p>Quiz: Using the $unset command. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=edqDAKMQTv4">Answer</a></p><p>Write an update query that will unset the interests key in the following document in the collection users. The primary key is username.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.users.update({username:'jimmy'}, {$unset:{'interests':1}})</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_ihswyr7bfqs_using_push_pop_pull_pushall_pullall_addtoset_ulink"/>1.7.2.22. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=iHSwyr7bfQs">Using $push, $pop, $pull, $pushAll, $pullAll, $addToSet</a></h4></div></div></div><p>Quiz: Using $push, $pop, $pull, $pushAll, $pullAll, $addToSet <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=bGbiIGEM0FY">Answer</a></p><p>Suppose you have the following document in your friends collection:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{ _id : "Mike", interests : [ "chess", "botany" ] }</pre><p>What will the result of the following updates be?</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.friends.update( { _id : "Mike" }, { $push : { interests : "skydiving" } } );
db.friends.update( { _id : "Mike" }, { $pop : { interests : -1 } } );
db.friends.update( { _id : "Mike" }, { $addToSet : { interests : "skydiving" } } );
db.friends.update( { _id : "Mike" }, { $pushAll: { interests : [ "skydiving" , "skiing" ] } } );</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{ _id : "Mike" , "interests" : [ "botany", "skydiving", "skydiving", "skiing" ] }</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_8unndduo09w_multi_update_ulink"/>1.7.2.23. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=8uNNDduO09w">Multi-update</a></h4></div></div></div><p>Quiz: Multi-update <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=B1DqIls06Tc">Answer</a></p><p>Recall the schema of the scores collection:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{
	"_id" : ObjectId("50844162cb4cf4564b4694f8"),
	"student" : 0,
	"type" : "exam",
	"score" : 75
}</pre><p>How would you give every record whose score was less than 70 an extra 20 points?</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.scores.update( { score : { $lt: 70 } } , { $inc : { score : 20 } } , { multi : true } );</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_pmhggc3hcn4_removing_data_ulink"/>1.7.2.24. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=PMhGgc3HCn4">Removing data</a></h4></div></div></div><p>Quiz: Removing data. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=T3wcuZHm6Ac">Answer</a></p><p>Recall the schema of the scores collection:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{
	"_id" : ObjectId("50844162cb4cf4564b4694f8"),
	"student" : 0,
	"type" : "exam",
	"score" : 75
}</pre><p>How would you delete every record whose score was less than 60?</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.scores.remove( { score : { $lt : 60 } } );</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_kuulkjqvh_a_getlasterror_ulink"/>1.7.2.25. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=kUulkJQvH_A">getLastError</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_raarrbxw0xi_java_driver_representing_documents_ulink"/>1.7.2.26. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=rAArRbxw0xI">Java driver: representing documents</a></h4></div></div></div><p>Quiz: Java driver: representing documents. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=3_b5ybZpero">Answer</a></p><p>How would you create a document using the Java driver with this JSON structure:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{
   "_id" : "user1",
   "interests" : [ "basketball", "drumming"]
}</pre><div class="itemizedlist"><ul><li>new HashMap().put("_id", "user1").put(Arrays.asList("basketball", "drumming"));</li><li>new BasicDBObject("_id", "user1").append("interests", "basketball", "drumming");</li><li>new DBObject("_id", "user1").append("interests", Arrays.asList("basketball", "drumming"));</li><li>new BasicDBObject("_id", "user1").append("interests", Arrays.asList("basketball", "drumming")); <span class="strong"><strong>OK</strong></span></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_wagixfmneri_java_driver_insert_ulink"/>1.7.2.27. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=wAGixFmneRI">Java driver: insert</a></h4></div></div></div><p>Quiz: Java driver: insert <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=v4I5ijidFGk">Answer</a></p><p>Do you expect the second insert below to succeed?</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">MongoClient client = new MongoClient();
        DB db = client.getDB("school");
        DBCollection people = db.getCollection("people");

        DBObject doc = new BasicDBObject("name", "Andrew Erlichson")
                .append("company", "10gen");

        try {
            people.insert(doc);      // first insert
            doc.removeField("_id");  // remove the "_id" field
            people.insert(doc);      // second insert
        } catch (Exception e) {
            e.printStackTrace();
        }</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_wgtereqw7zi_java_driver_find_findone_count_ulink"/>1.7.2.28. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=wgTeReQW7zI">Java driver: find, findOne, count</a></h4></div></div></div><p>Quiz: Java driver: find, findOne, count</p><p>In the following code snippet:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">MongoClient client = new MongoClient();
        DB db = client.getDB("school");
        DBCollection people = db.getCollection("people");
        DBObject doc;
        xxxx
        System.out.println(doc);</pre><p>Answer:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">doc = people.findOne();</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_5utrldhd06i_java_driver_query_criteria_ulink"/>1.7.2.29. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=5UtrLdHD06I">Java driver: query criteria</a></h4></div></div></div><p>Quiz: Java driver: query criteria. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=_Zxiwo3lo28">Answer</a></p><p>Given a collection of documents with two fields — type and score — what is the correct line of code to find all documents where type is "quiz" and score is greater than 20 and less than 90. Select all that apply.</p><div class="itemizedlist"><ul><li>scores.find(new BasicDBObject("score", new BasicDBObject("$gt", 20).append("$lt", 90));</li><li>scores.find(new BasicDBObject("type", "quiz").append("score", new BasicDBObject("$gt", 20).append("$lt", 90))) <span class="strong"><strong>OK</strong></span></li><li>scores.find(new BasicDBObject("type", "quiz").append("$gt", new BasicDBObject("score", 20)).append("$lt", new BasicDBObject("score", 90)))</li><li>scores.find(QueryBuilder.start("type").is("quiz").and("score").greaterThan(20).lessThan(90).get()) <span class="strong"><strong>OK</strong></span></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_ow_0h_ux3hq_java_driver_field_selection_ulink"/>1.7.2.30. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=oW-0h-Ux3hQ">Java driver: field selection</a></h4></div></div></div><p>Quiz: Java driver: field selection. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=F8kAQ88a3Bg">Answer</a></p><p>Given a variable named "students" of type DBCollection, which of the following lines of code could be used to find all documents in the collection, retrieving only the "phoneNumber" field.</p><div class="itemizedlist"><ul><li>students.find(new BasicDBObject("phoneNumber", 1).append("_id", 0))</li><li>students.find(new BasicDBObject("phoneNumber", 1))</li><li>students.find(new BasicDBObject(), new BasicDBObject("phoneNumber", 1).append("_id", 0))</li><li>students.find(new BasicDBObject("phoneNumber", 1).append("_id", 0), new BasicDBObject())</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_b8hwpdz9u38_java_driver_dot_notation_ulink"/>1.7.2.31. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=b8HWPdz9u38">Java driver: dot notation</a></h4></div></div></div><p>Quiz: Java driver: dot notation. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=hWL1otPB51w">Answer</a></p><p>In the following code snippet, what do you think will happen if there exists in the collection a document that matches the query but does not have a key called "media.url"?</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">DBObject findOneUrlByMediaType(DBCollection videos, String mediaType) {
    DBObject query = new BasicDBObject("media.type", mediaType);
    DBObject projection = new BasicDBObject("media.url", true);

    return videos.findOne(query, projection);
}</pre><div class="itemizedlist"><ul><li>It will throw an exception.</li><li>It will return an empty document</li><li>It will return a document containing a single field containing the document’s _id  <span class="strong"><strong>OK</strong></span></li><li>There is not enough information to know</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_syps9plbxrs_java_driver_sort_skip_and_limit_ulink"/>1.7.2.32. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=sYPs9PlBxrs">Java driver: sort, skip and limit</a></h4></div></div></div><p>Quiz: Java driver: sort, skip and limit</p><p>Supposed you had the following documents in a collection named things.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{ "_id" : 0, "value" : 10 }
{ "_id" : 1, "value" : 5 }
{ "_id" : 2, "value" : 7 }
{ "_id" : 3, "value" : 20 }</pre><p>If you performed the following query in the Java driver:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">collection.find().sort(new BasicDBObject("value", -1)).skip(2).limit(1);</pre><p>Quiz: Java driver: update and remove</p><p>which document would be returned?</p><div class="itemizedlist"><ul><li>The document with _id=0</li><li>The document with _id=1</li><li>The document with _id=2 <span class="strong"><strong>OK</strong></span></li><li>The document with _id=3</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_6n9rn6vzryg_java_driver_update_and_remove_ulink"/>1.7.2.33. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=6n9rN6vzRyg">Java driver: update and remove</a></h4></div></div></div><p>Quiz: Java driver: update and remove</p><p>In the following code fragment, what is the Java expression in place of xxxx that will set the field "examiner" to the value "Jones" for the document with _id of 1. Please use the $set operator.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE"># update using $set
        scores.update(new BasicDBObject("_id", 1), xxxx);</pre><p>Answer:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">new BasicDBObject("$set", new BasicDBObject("examiner", "Jones"))</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_pwzmqtsjfgs_java_driver_findandmodify_ulink"/>1.7.2.34. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=PWZMQTsJFGs">Java driver: findAndModify</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_cklfvzds9fu_blog_user_interface_ulink"/>1.7.2.35. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=cKLfVZDs9FU">Blog, User Interface</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_jeynwgk6fjc_blog_session_management_ulink"/>1.7.2.36. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=JeyNWgk6FJc">Blog, Session Management</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_vdejqpsf7gg_blog_internals_ulink"/>1.7.2.37. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=VdEJQPsf7gg">Blog, Internals</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_axlfwtldzp8_python_eats_java_ulink"/>1.7.2.38. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=AXlFWtLDZp8">Python Eats Java</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_lk4l2l0q0va_installing_python_on_windows_ulink"/>1.7.2.39. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=lK4L2l0q0vA">Installing Python on Windows</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_hhgfjhjxsoi_installing_pymongo_windows_ulink"/>1.7.2.40. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=HhgFjhJxsOI">Installing Pymongo, Windows</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_ywuf9ud5dks_installing_pymongo_mac_ulink"/>1.7.2.41. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=ywuf9uD5dks">Installing Pymongo, Mac</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_homework_2_1"/>1.7.2.42. Homework 2.1</h4></div></div></div><p>In this problem, you will be using a collection of student scores that is similar to what we used in the lessons. Please download the grades.json file and import it into your local mongo database as follows:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">mongoimport -d students -c grades &lt; grades.json</pre><p>The dataset contains 4 scores for 200 students.
First, let�s confirm your data is intact; the number of documents should be 800.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">&gt; use students
&gt; db.grades.count()
800</pre><p>This next query, which uses the aggregation framework that we have not taught yet, will tell you the student_id with the highest average score:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">&gt; db.grades.aggregate({'$group':{'_id':'$student_id', 'average':{$avg:'$score'}}}, {'$sort':{'average':-1}}, {'$limit':1})</pre><p><span class="strong"><strong>Note: Aggregation requires <a class="ulink" href="http://www.mongodb.org/downloads">mongodb 2.2</a> or above.</strong></span>
The answer, deep in the resulting document, should be student_id 161 with an average of approximately 85.2.</p><p>The answer, deep in the resulting document, should be student_id 161 with an average of approximately 85.2.</p><p>Now it’s your turn to analyze the data set. Find all exam scores greater than or equal to 65. and sort those scores from lowest to highest.
What is the student_id of the lowest exam score above 65?</p><div class="itemizedlist"><ul><li>115</li><li>22</li><li>48</li><li>114 <span class="strong"><strong>RTA</strong></span></li><li>87</li><li>67</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_github_com_nelsonjava_m101j_tree_master_week2_homework_2_2_ulink_ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_bpz5e_l17ry_answer_ulink"/>1.7.2.43. <a class="ulink" href="https://github.com/nelsonjava/m101j/tree/master/week2">Homework 2.2</a> <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=Bpz5E_L17RY">Answer:</a></h4></div></div></div><p>Write a program in the language of your choice that will remove the grade of type "homework" with the lowest score for each student from the dataset that you imported in HW 2.1.
Since each document is one grade, it should remove one document per student.</p><p>Hint/spoiler: If you select homework grade-documents, sort by student and then by score, you can iterate through and find the
lowest score for each student by noticing a change in student id. As you notice that change of student_id, remove the document.</p><p>To confirm you are on the right track, here are some queries to run after you process the data with the correct answer shown:</p><p>Let us count the number of grades we have:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">&gt; db.grades.count()
600</pre><p>Now let us find the student who holds the 101st best grade across all grades:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">&gt; db.grades.find().sort({'score':-1}).skip(100).limit(1)
{ "_id" : ObjectId("513257f68d6e7cb63d7b1ead"), "student_id" : 164, "type" : "exam", "score" : 87.06518186605459 }</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_homework_2_3_ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_bpz5e_l17ry_answer_ulink"/>1.7.2.44. Homework 2.3 <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=Bpz5E_L17RY">Answer</a></h4></div></div></div><p>Now let us sort the students by student_id, score and see what the top five docs are:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">&gt; db.grades.find({},{'student_id':1, 'type':1, 'score':1, '_id':0}).sort({'student_id':1, 'score':1, }).limit(5)
{ "student_id" : 0, "type" : "quiz", "score" : 16.28337833467709 }
{ "student_id" : 0, "type" : "exam", "score" : 64.40706888325151 }
{ "student_id" : 0, "type" : "homework", "score" : 80.31845193864314 }
{ "student_id" : 1, "type" : "quiz", "score" : 11.45004974085635 }
{ "student_id" : 1, "type" : "homework", "score" : 31.56114538077717 }</pre><p>To verify that you have completed this task correctly, provide the identify of the student with the highest average in the class with
following query that uses the aggregation framework. The answer will appear in the _id field of the resulting document.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">&gt; db.grades.aggregate({'$group':{'_id':'$student_id', 'average':{$avg:'$score'}}}, {'$sort':{'average':-1}}, {'$limit':1})</pre><p>Enter the student ID below. Please enter just the number, with no spaces, commas or other characters.</p><p><a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=Bpz5E_L17RY">Answer:</a></p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">124</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_github_com_nelsonjava_m101j_tree_master_week3_homework_2_3_ulink"/>1.7.2.45. <a class="ulink" href="https://github.com/nelsonjava/m101j/tree/master/week3">Homework 2.3</a></h4></div></div></div><p>Blog User Sign-up and Login
<a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/hw2-3.7f0c86868288.zip">hw2.3.zip</a> or
<a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/hw2-3.a7c14526bec0.tar">hw2.3.tar</a>
and unpack. This is the beginning of the blog project with the UI for creating an logging in blog authors, but nothing to display posts.</p><p>There is a pom.xml file that describes the project.</p><p>The project roughly follows the model/view/controller paradigm. BlogController.java is the controller and the model. The templates comprise the view. Here is a description of the directories and files.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">/src/main/java/course - contains source code
/src/main/resources/freemarker - contains templates
validate.py - the python script that will validate you got it right
run.sh - the mvn command that starts it running if you don't want to use an IDE</pre><p>If everything is working properly, you should be able to start the blog by typing:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">mvn compile exec:java -Dexec.mainClass=course.BlogController</pre><p>If you goto <a class="ulink" href="http://localhost:8082/">http://localhost:8082</a> you should see a message �this is a placeholder for the blog�</p><p>Here are some URLs that must work when you are done.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">http://localhost:8082/signup
http://localhost:8082/login
http://localhost:8082/logout</pre><p>When you login or sign-up, the blog will redirect to <a class="ulink" href="http://localhost:8082/welcome">http://localhost:8082/welcome</a> and that must work properly, welcoming the user by username</p><p>We have removed four Java statements from UserDAO and marked the areas where you need to work with XXX.
You should not need to touch any other code. The java statements that you are going to add will add a new user upon sign-up and validate a login by retrieving the right user document.</p><p>The blog stores its data in the blog database in two collections, users and sessions. Here are two example docs for a username �erlichson� with password �fubar�. You can insert these if you like, but you don�t need to.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">&gt; db.users.find()
{ "_id" : "erlichson", "password" : "VH9IFu+/vUNSKTzZsFZEOsK1,-1924261330" }
&gt;
&gt; db.sessions.find()
{ "_id" : "AN4M7warH+fdKOszU8qnd2Hmfn8JZFFZ9sff4zcPRpw=", "username" : "erlichson" }
&gt;</pre><p>Once you have the the project working, the following steps should work:</p><div class="itemizedlist"><ul><li>go to <a class="ulink" href="http://localhost:8082/signup">http://localhost:8082/signup</a></li><li>create a user</li></ul></div><p>It should redirect you to the welcome page and say: welcome username, where username is the user you signed up with. Now</p><div class="itemizedlist"><ul><li>Goto <a class="ulink" href="http://localhost:8082/logout">http://localhost:8082/logout</a></li><li>Now login <a class="ulink" href="http://localhost:8082/login">http://localhost:8082/login</a>.</li></ul></div><p>Ok, now it�s time to validate you got it all working.</p><p>There was one additional program that should have been downloaded in the project called validate.py.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">python validate.py</pre><p>If you got it right, it will provide a validation code for you to enter into the box below. Enter just the code, no spaces.
<span class="strong"><strong>Notes on validation</strong></span></p><p>The Python validation script requires the following python modules be installed on your computer: pymongo, urllib, urllib2, and cookielib. A typical Python installation will already have most of these installed except pymongo.</p><p>If you have python-setuptools installed, the command "easy_install" makes this simple. Any other missing packages will show up when validate.py is run, and can be installed in a similar fashion.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">$ easy_install pymongo</pre><p>Alternative Java-based Validation</p><p>We also have an alternative validation program written in Java. If you are having trouble getting the Python one to
work due to issues with your Python installation, you can try this. Start by downloading Validate.zip into a directory. Now cd to that directory and issue the following command</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">java -jar Validate.jar</pre><p><a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=sktDBIkR_pA">Answer:</a></p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">fhj837hf9376hgf93hf832jf9</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="mongo-m101j-week3"/>1.7.3. WEEK 3 - SCHEMA DESIGN</h3></div></div></div><p>You were most recently in Handling Blobs. If you’re done with that, choose another section on the left.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_hfhsij_nvo4_introduction_to_week_3_ulink"/>1.7.3.1. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=hFhSIJ-NvO4">Introduction to Week 3</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_itnfwjmnq4a_mongodb_schema_design_ulink"/>1.7.3.2. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=itnfWjMnQ4A">MongoDB Schema Design</a></h4></div></div></div><p>Quiz: MongoDB Schema Design</p><p>What’s the single most important factor in designing your application schema within MongoDB?</p><div class="itemizedlist"><ul><li>Making the design extensible.</li><li>Making it easy to read by a human.</li><li>Matching the data access patterns of your application. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=OVDnLJXpqNE"><span class="strong"><strong>OK</strong></span></a></li><li>Keeping the data in third normal form.</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_gx_f2s4hd8_relational_normalization_ulink"/>1.7.3.3. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=GX__f2s4hd8">Relational Normalization</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_prylehh5t84_mongo_design_for_blog_ulink"/>1.7.3.4. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=PRylEHH5t84">Mongo Design for Blog</a></h4></div></div></div><p>Quiz: Mongo Design for Blog</p><p>Which data access pattern is not well supported by the blog schema?</p><div class="itemizedlist"><ul><li>Collecting the most recent blog entries for the blog home page</li><li>Collecting all the information to display a single post</li><li>Collecting all comments by a single author</li><li>Providing a table of contents by tag <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=s5E0T4caqj4"><span class="strong"><strong>OK</strong></span></a></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_zvqnwvwb2_o_alternative_schema_for_blog_ulink"/>1.7.3.5. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=ZvqNWVWB2-o">Alternative Schema for Blog</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_yfrmkdpaams_living_without_constraints_ulink"/>1.7.3.6. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=YFRMkDPaams">Living Without Constraints</a></h4></div></div></div><p>Quiz: Living Without Constraints</p><p>What does Living Without Constraints refer to?</p><div class="itemizedlist"><ul><li>Living every day like it’s your last</li><li>Saying whatever you want when you want it</li><li>Keeping your data consistent even though MongoDB lacks foreign key constraints <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=3VckBMGInic"><span class="strong"><strong>OK</strong></span></a></li><li>Wearing no belt</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_ffrr3qjrfww_living_without_transactions_ulink"/>1.7.3.7. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=FfRr3qjRfww">Living without Transactions</a></h4></div></div></div><p>Quiz: Living without Transactions</p><p>Which of the following operations operate atomically within a single document? Check all that apply.
<a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=189zABW3HHk">Answer</a></p><div class="itemizedlist"><ul><li>Update <span class="strong"><strong>OK</strong></span></li><li>findAndModify <span class="strong"><strong>OK</strong></span></li><li>$addToSet (within an update) <span class="strong"><strong>OK</strong></span></li><li>$push within an update <span class="strong"><strong>OK</strong></span></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_ccsfon0vulq_one_to_one_relations_ulink"/>1.7.3.8. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=cCsfon0vUlQ">One to One Relations</a></h4></div></div></div><p>Quiz: One to One Relations. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=BjW64RkzlGg">Answer</a></p><p>What’s a good reason you might want to keep two documents that are related to each other one-to-one in separate collections? Check all that apply.</p><div class="itemizedlist"><ul><li>Because you want to allow atomic update of both documents at once.</li><li>To reduce the working set size of your application.</li><li>To enforce foreign key constraints</li><li>Because the combined size of the documents would be larger than 16MB</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_eiap1kbvkuc_one_to_many_relations_ulink"/>1.7.3.9. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=EIaP1KbVkUc">One To Many Relations</a></h4></div></div></div><p>Quiz: One To Many Relations. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=KQcspnr-Y2M">Answer</a></p><p>When is it recommended to represent a one to many relationship in multiple collections?</p><div class="itemizedlist"><ul><li>Always</li><li>Whenever the many is large <span class="strong"><strong>OK</strong></span></li><li>Whenever the many is actually few</li><li>Never</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_feyyjz7zehc_many_to_many_relations_ulink"/>1.7.3.10. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=fEYYjZ7zEHc">Many to Many Relations</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_ocu9wnul9yq_multikeys_ulink"/>1.7.3.11. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=ocU9WNUL9YQ">Multikeys</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_xin0dqht08q_benefits_of_embedding_ulink"/>1.7.3.12. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=XIN0Dqht08Q">Benefits of Embedding</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_lijxyqklgwy_trees_ulink"/>1.7.3.13. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=lIjXyQklGWY">Trees</a></h4></div></div></div><p>Quiz: Trees. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=80P6yVSkKQY">Answer</a></p><p>Given the following typical document for a e-commerce category hierarchy collection called categories</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{
  _id: 34,
  name : "Snorkeling",
  parent_id: 12,
  ancestors: [12, 35, 90]
}</pre><p>Which query will find all descendants of the snorkeling category?</p><div class="itemizedlist"><ul><li>db.categories.find({ancestors:{<span class="emphasis"><em>$in</em></span>:[12,35,90]}})</li><li>db.categories.find({parent_id: 34})</li><li>db.categories.find({_id:{<span class="emphasis"><em>$in</em></span>:[12,35,90]}})</li><li>db.categories.find({ancestors:34}) <span class="strong"><strong>OK</strong></span></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_jdz_hfoj0vg_when_to_denormalize_ulink"/>1.7.3.14. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=jDZ-HFoJ0vg">When to Denormalize</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_q_uyot4kbk4_handling_blobs_ulink"/>1.7.3.15. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=Q_uyOT4Kbk4">Handling Blobs</a></h4></div></div></div><p>Quiz: Handling Blobs. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=7t_kcScYlQs">Answer</a></p><p>Which of the following statements are true about GridFS</p><div class="itemizedlist"><ul><li>GridFS stores large blobs in a single collection by breaking up the file into multiple pieces.</li><li>Each gridFS document is given a unique filename.</li><li>GridFS stores large blobs in two collections, one for metadata and one for the blob chunks. <span class="strong"><strong>OK</strong></span></li><li>GridFS compresses your file on disk.</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_onrpiyku6hc_learn_more_about_gridfs_ulink"/>1.7.3.16. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=oNRPiyKu6Hc">Learn more about GridFS</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_wlnpns5hc6m_sidebar_importing_from_a_twitter_feed_ulink"/>1.7.3.17. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=wlNPns5hc6M">Sidebar: Importing from a Twitter feed</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_ip_dnv9ze2c_hw_3_1_ulink"/>1.7.3.18. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=iP_dNV9ze2c">HW 3.1</a></h4></div></div></div><p>Homework: HW 3.1</p><p>Download the students.json file to your computer and import it into your local Mongo instance with this command:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">$ mongoimport -d school -c students &lt; students.json</pre><p>This dataset holds the same type of data as last week’s grade collection, but it’s modeled differently. You might want to start by inspecting it in the Mongo shell.</p><p>Write a program in Java that will remove the lowest homework score for each student. Since there is a single document for each student containing an array of scores, you will need to update the scores array and remove the homework.</p><p>Hint/spoiler: With the new schema, this problem is a lot harder and that is sort of the point. One way is to find the lowest homework in code and then update the scores array with the low homework pruned. If you are struggling with the Java side of this, look at the ArrayList.remove method, which can remove stuff from a Java ArrayList. Note also that when the value for a particular key is list within MongoDB, the Java driver returns a BasicDBList, which can you cast to an ArrayList.</p><p>To confirm you are on the right track, here are some queries to run after you process the data with the correct answer shown:</p><p>Let us count the number of students we have:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">&gt; use school
&gt; db.students.count()
200</pre><p>Let’s see what Demarcus Audette’s record looks like:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">&gt;db.students.find({_id:100}).pretty()
{
	"_id" : 100,
	"name" : "Demarcus Audette",
	"scores" : [
		{
			"type" : "exam",
			"score" : 30.61740640636871
		},
		{
			"type" : "quiz",
			"score" : 14.232338213537322
		},
		{
			"type" : "homework",
			"score" : 31.414212985763324
		}
	]
}</pre><p>To verify that you have completed this task correctly, provide the identify of the
student with the highest average in the class with following query that uses the aggregation
framework. The answer will appear in the _id field of the resulting document.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">&gt; db.students.aggregate({'$unwind':'$scores'},{'$group':{'_id':'$_id', 'average':{$avg:'$scores.score'}}},
{'$sort':{'average':-1}}, {'$limit':1})</pre><p>Enter just the numeric value of the _id below: <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=i7C9_57Cmqs">Answer</a></p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">37</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_seh6y4lhkwq_hw_3_2_ulink"/>1.7.3.19. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=SEh6Y4lHkWQ">HW 3.2</a></h4></div></div></div><p>Homework: HW 3.2</p><p><span class="strong"><strong>Making your blog accept posts</strong></span></p><p>In this homework you will be enhancing the blog project to insert entries into the posts
collection. After this, the blog will work. It will allow you to add blog posts with a title,
body and tags and have it be added to the posts collection properly.</p><p>We have provided the code that creates users and allows you to
login (the assignment from last week). To get started, please download hw3-2and3-3.tar or hw3-2and3-3.zip and unpack.
You will be using these file for this homework and the HW 3.3.</p><p>The areas where you need to add code are marked with XXX. You need only touch the BlogPostDAO class.
There are three locations for you to add code for this problem.
Scan that file for XXX to see where to work. Here is an example of valid blog post:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">&gt; db.posts.find().pretty()
{
	"_id" : ObjectId("513d396da0ee6e58987bae74"),
	"title" : "Martians to use MongoDB",
	"author" : "andrew",
	"body" : "Representatives from the planet Mars announced today that the planet would adopt MongoDB as a planetary standard. Head Martian Flipblip said that MongoDB was the perfect tool to store the diversity of life that exists on Mars.",
	"permalink" : "martians_to_use_mongodb",
	"tags" : [
		"martians",
		"seti",
		"nosql",
		"worlddomination"
	],
	"comments" : [ ],
	"date" : ISODate("2013-03-11T01:54:53.692Z")
}</pre><p>As a reminder, to run your blog you type</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">mvn compile exec:java -Dexec.mainClass=course.BlogController</pre><p>Or, use an IDE to run it. To play with the blog you can navigate to the following URLs</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">http://localhost:8082/
http://localhost:8082/signup
http://localhost:8082/login
http://localhost:8082/newpost</pre><p>You will be proving that it works by running our validation script as follows:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">python validate.py</pre><p>You need to run this in a separate terminal window while your blog is running and while the database is running.
It makes connections to both to determine if your program works properly.
Validate connects to localhost:8082 and expects that mongod is running on localhost on port 27017.</p><p>Read if you want to run your blog on non-standard port, different host or connected to a mongod on different server.</p><p>By popular demand, validate.py now takes some optional arguments that you can discover with
the -h flag. These arguments will allow you to direct validate.py to make a connection to a
web server at different port on a different host and connect to a mongod on a different host.
You can also use a database name other than blog, a necessity if you are running on the free tier at MongoHW (for eg).
I won’t go into how these arguments work, as they are pretty self documenting.
Note that to run the blog.py code to connect to a database outside of localhost
(for example to a database at MongoHQ), you will need to make some global changes.</p><p>The python validator requires Python 2.7. The code is not 3.0 compliant.</p><p>Ok, once you get the blog posts working, validate.py will print out a
validation code for HW 3.2. Please enter it below, exactly as shown with no spaces.</p><p><a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=MrHQzCoIuj4">Answer</a></p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">njkfd489hj9fhds8934kf23</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_hpsgvt2beyq_hw_3_3_ulink"/>1.7.3.20. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=HPSgVT2BEYQ">HW 3.3</a></h4></div></div></div><p>Homework: HW 3.3</p><p>Making your blog accept comments</p><p>In this homework you will add code to your blog so that it accepts comments.
You will be using the same code as you downloaded for HW 3.2.</p><p>Once again, the area where you need to work is marked with an XXX in the BlogPostsDAO class.
There is only a single location you need to work to insert comments.
You don’t need to figure out how to retrieve comments for this homework because the code you did in 3.2
already pulls the entire blog post (unless you specifically projected to eliminate the comments)
and we gave you the code in the template that pulls them out of the JSON document.</p><p>This assignment has fairly little code, but it’s a little more subtle than the previous assignment
because you are going to be manipulating an array within the Mongo document.
For the sake of clarity, here is a document out of the posts collection from a working project that also has comments.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{
	"_id" : ObjectId("513d396da0ee6e58987bae74"),
	"author" : "andrew",
	"body" : "Representatives from the planet Mars announced today that the planet would adopt MongoDB as a planetary standard. Head Martian Flipblip said that MongoDB was the perfect tool to store the diversity of life that exists on Mars.",
	"comments" : [
		{
			"author" : "Larry Ellison",
			"body" : "While I am deeply disappointed that Mars won't be standardizing on a relational database, I understand their desire to adopt a more modern technology for the red planet.",
			"email" : "larry@oracle.com"
		},
		{
			"author" : "Salvatore Sanfilippo",
			"body" : "This make no sense to me. Redis would have worked fine."
		}
	],
	"date" : ISODate("2013-03-11T01:54:53.692Z"),
	"permalink" : "martians_to_use_mongodb",
	"tags" : [
		"martians",
		"seti",
		"nosql",
		"worlddomination"
	],
	"title" : "Martians to use MongoDB"
}</pre><p>Note that you add comments in this blog from the blog post detail page, which appears at</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">http://localhost:8082/post/post_slug</pre><p>where post_slug is the permalink. For the sake of eliminating doubt, the permalink for the example blog post above is
<a class="ulink" href="http://localhost:8082/post/martians_to_use_mongodb">http://localhost:8082/post/martians_to_use_mongodb</a></p><p>You will run validate.py to check your work, much like the last problem.
Validate.py will run through and check the requirements of HW 3.2 and
then will check to make sure it can add blog comments, as required by this problem,
HW 3.3. It checks the web output as well as the database documents.
This validate.py program will print out a 3.3 validation code that you should enter below.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">python validate.py</pre><p>Once you have the validation code, please copy and paste in the box below, no spaces.</p><p><a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=qts8vpcvAjc">Answer</a></p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">ihfr48nf89jk09309kj0d2d</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="mongo-m101j-week4"/>1.7.4. WEEK 4 - PERFORMANCE</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_ma0qpagggy8_introduction_ulink"/>1.7.4.1. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=MA0QpaGggY8">Introduction</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_kkiaqyqyocc_indexes_ulink"/>1.7.4.2. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=kkIAqyqYOCc">Indexes</a></h4></div></div></div><div class="itemizedlist"><ul><li>Database Performance</li></ul></div><p>Quiz: Indexes</p><p>Which optimization will typically have the greatest impact on the performance of a database.</p><div class="itemizedlist"><ul><li>Adding more memory so that the working set fits in memory.</li><li>Adding a faster drive so that operations that hit disk will happen more quickly.</li><li>Replacing your CPU with a faster one (say one 2x as fast)</li><li>Adding appropriate indexes on large collections so that only a small percentage of queries need to scan the collection. <span class="strong"><strong>OK</strong></span></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_emb_creating_indexes_ulink"/>1.7.4.3. <a class="ulink" href="https://www.youtube.com/watch?feature=player_emb|">Creating Indexes</a></h4></div></div></div><div class="itemizedlist"><ul><li>use school</li><li>db.students.find().pretty()</li><li>db.studentes.find({<span class="emphasis"><em>student_id</em></span> : 5})</li><li>db.studentes.findOne({<span class="emphasis"><em>student_id</em></span> : 5})</li><li>db.studentes.findOne({<span class="emphasis"><em>student_id</em></span> : 5000000})</li><li>db.studentes.find({<span class="emphasis"><em>student_id</em></span> : 5000000})</li><li>db.studentes.ensureIndex({student_id : 1})</li><li>db.studentes.find({<span class="emphasis"><em>student_id</em></span> : 5000000}).pretty()</li><li>db.studentes.find({<span class="emphasis"><em>student_id</em></span> : 7000000}).pretty()</li><li>db.studentes.find({<span class="emphasis"><em>class</em></span> : 7000000}).pretty()</li><li>db.studentes.ensureIndex({student_id:1,class:-1})</li></ul></div><p>Quiz: Creating Indexes</p><p>Please provide the mongo shell command to add an index to a collection named students, having the index key be class, student_name.</p><p>Answer:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.students.ensureIndex({class:1, student_name:1})</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_hh7kyu_fxg_discovering_indexes_ulink"/>1.7.4.4. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=hH7kYu_-FXg">Discovering indexes</a></h4></div></div></div><div class="itemizedlist"><ul><li>use school</li><li>db.system.indexes.find()</li><li>db.students.getIndexes()</li><li>db.students.dropIndex({<span class="emphasis"><em>student_id</em></span>:1})</li><li>db.students.getIndexes()</li><li>db.studentes.find({<span class="emphasis"><em>student_id</em></span> : 7000000}).pretty()</li><li>use test</li><li>db.system.indexes.find()</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_jo_pugonalc_multikey_indexes_ulink"/>1.7.4.5. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=JO_puGONaLc">Multikey Indexes</a></h4></div></div></div><div class="itemizedlist"><ul><li>{tags:["cycling","tennis","football"]}
{categories:["sport","hobbies"]}</li><li>ensureIndex({tags:1})</li><li>use test</li><li>db.bbb.insert({a:1, b:1})</li><li>db.bbb.ensureIndex({a:1,b:1})</li><li>db.bbb.insert({a:[1,2,3], b:1})</li><li>db.bbb.insert({a:5,b:[1,2,3]})</li><li>db.bbb.getIndexes()</li><li>db.bbb.insert({a:[1,2,4],b:[1,2,3]}) - cannot index parallel [b] [a]</li></ul></div><p>Quiz: Multikey Indexes</p><p>Suppose we have a collection foo that has an index created as follows:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.foo.ensureIndex({a:1, b:1})</pre><p>Which of the following inserts are valid to this collection?</p><p>db.foo.insert({a:["apples","oranges"], b:"grapes"}) <span class="strong"><strong>OK</strong></span></p><p>db.foo.insert({a:"grapes", b:"oranges"}) <span class="strong"><strong>OK</strong></span></p><p>db.foo.insert({a:"grapes", b:[8,9,10]}) <span class="strong"><strong>OK</strong></span></p><p>db.foo.insert({a:[1,2,3], b:[5,6,7]})</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_mpsgg2p33rq_multikey_continued_ulink"/>1.7.4.6. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=mPSGG2p33RQ">Multikey Continued</a></h4></div></div></div><div class="itemizedlist"><ul><li>db.people.find().pretty()</li><li>db.people.ensureIndex({<span class="emphasis"><em>addresses.tag</em></span>:1})</li><li>db.people.ensureIndex({<span class="emphasis"><em>addresses.phones</em></span>:1})</li><li>db.people.getIndexes()</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_764mqg1il8e_index_creation_option_unique_ulink"/>1.7.4.7. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=764mQG1iL8E">Index Creation option, Unique</a></h4></div></div></div><div class="itemizedlist"><ul><li>db.stuff.insert({thing:'pear'})</li><li>db.stuff.ensureIndex({<span class="emphasis"><em>thing</em></span>:1})</li><li>db.stuff.insert({thing:'pear'})</li><li>db.stuff.insert({thing:'apple'})</li><li>db.stuff.getIndexes()</li><li>db.stuff.dropIndex({<span class="emphasis"><em>thing</em></span>:1})</li><li>db.stuff.ensureIndex({<span class="emphasis"><em>thing</em></span>:1},{unique:true}) - E11000 duplicate key error: test.stuff.$thin_1 dup key: { : "pear"}</li><li>db.stuff.remove({_id:ObjectId("50a…")}) - Delete pear</li><li>db.stuff.ensureIndex({<span class="emphasis"><em>thing</em></span>:1},{unique:true})</li><li>db.stuff.getIndexes()</li><li>db.stuff.find()</li><li>db.stuff.insert({thing:'pear'}) - E11000 duplicate key error index: test.stuff.$thing_1 dup key: { : "apple"}</li><li>db.stuff.insert({_id:1, b:1})</li><li>db.stuff.insert({<span class="emphasis"><em>id:1, b:2})  - E11000 duplicate key error index: test.stuff.$_id</em></span> dup key: { : 1.0}</li></ul></div><p>Quiz: Index Creation option, Unique</p><p>Please provide the mongo shell command to add a unique index to the collection students on the keys student_id, class_id.</p><p>Answer:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.students.ensureIndex({student_id:1, class_id:1}, {unique:true})</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_yjawpxngvou_index_creation_removing_dups_ulink"/>1.7.4.8. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=YJaWPXNGvoU">Index Creation, Removing Dups</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_s4sywlndtti_index_creation_sparse_ulink"/>1.7.4.9. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=s4sYwLndtTI">Index Creation, Sparse</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_28wcvoxmy7a_index_creation_background_ulink"/>1.7.4.10. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=28wCvoXmY7A">Index Creation, Background</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_inmabt5rkf0_using_explain_ulink"/>1.7.4.11. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=inmABt5RKf0">Using Explain</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_lwms58y_3jc_when_is_an_index_used_ulink"/>1.7.4.12. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=Lwms58Y_3Jc">When is an index used?</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_oywrqwny46s_how_large_is_your_index_ulink"/>1.7.4.13. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=oywrqWNY46s">How large is your index?</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_xiujksufzua_index_cardinality_ulink"/>1.7.4.14. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=xiujksUfzUA">Index Cardinality</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_on8hhr1agsi_index_selectivity_ulink"/>1.7.4.15. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=On8HHR1agsI">Index Selectivity</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_kson_skaicg_hinting_an_index_ulink"/>1.7.4.16. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=ksOn-SkaIcg">Hinting an Index</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_dlkcfo7wtgu_hinting_in_java_ulink"/>1.7.4.17. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=dlKcfo7WtGU">Hinting in Java</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_1sadn_nkwhy_efficiency_of_index_use_ulink"/>1.7.4.18. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=1sADN-NKwhY">Efficiency of Index Use</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_ukudyqnvl6i_geospatial_indexes_ulink"/>1.7.4.19. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=UKUDYqNVL6I">Geospatial Indexes</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_vy3_h4mzkiy_geospacial_spherical_ulink"/>1.7.4.20. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=vY3_H4MzkIY">Geospacial Spherical</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_awuvc_o7qkk_logging_slow_queries_ulink"/>1.7.4.21. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=aWuvC-O7Qkk">Logging Slow Queries</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_pn1yhrup9_i_profiling_ulink"/>1.7.4.22. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=pN1Yhrup9-I">Profiling</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_d9ylxgy7nyo_mongotop_ulink"/>1.7.4.23. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=D9YLXgy7NYo">Mongotop</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_elwqo_ajmri_mongostat_ulink"/>1.7.4.24. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=eLWQO_AJmrI">Mongostat</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_bdxt_vzdyqc_sharding_overview_ulink"/>1.7.4.25. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=BDxT-VZdYqc">Sharding Overview</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_0tpxspgyk4i_hw_4_1_ulink"/>1.7.4.26. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=0tpXSPgYk4I">HW 4.1</a></h4></div></div></div><p>Homework: HW 4.1</p><p>Suppose you have a collection with the following indexes:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">&gt; db.products.getIndexes()
[
	{
		"v" : 1,
		"key" : {
			"_id" : 1
		},
		"ns" : "store.products",
		"name" : "_id_"
	},
	{
		"v" : 1,
		"key" : {
			"sku" : 1,
			"unique" : true
		},
		"ns" : "store.products",
		"name" : "sku_1_unique_true"
	},
	{
		"v" : 1,
		"key" : {
			"price" : -1
		},
		"ns" : "store.products",
		"name" : "price_-1"
	},
	{
		"v" : 1,
		"key" : {
			"description" : 1
		},
		"ns" : "store.products",
		"name" : "description_1"
	},
	{
		"v" : 1,
		"key" : {
			"category" : 1,
			"brand" : 1
		},
		"ns" : "store.products",
		"name" : "category_1_brand_1"
	},
	{
		"v" : 1,
		"key" : {
			"reviews.author" : 1
		},
		"ns" : "store.products",
		"name" : "reviews.author_1"
	}</pre><p>Which of the following queries can utilize an index. Check all that apply. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=ecMrwMMBqIg">Answer</a></p><div class="itemizedlist"><ul><li>db.products.find({<span class="emphasis"><em>brand</em></span>:"GE"})</li><li>db.products.find({<span class="emphasis"><em>brand</em></span>:"GE"}).sort({price:1}) <span class="strong"><strong>OK</strong></span></li><li>db.products.find({$and:[{price:{$gt:30}},{price:{$lt:50}}]}).sort({brand:1}) <span class="strong"><strong>OK</strong></span></li><li>db.products.find({brand:'GE'}).sort({category:1, brand:-1}).explain()</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_zz8tere95ss_hw_4_2_ulink"/>1.7.4.27. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=Zz8TerE95Ss">HW 4.2</a></h4></div></div></div><p>Homework: HW 4.2</p><p>Suppose you have a collection called tweets whose documents contain information about the created_at time of the tweet and the user’s followers_count
at the time they issued the tweet. What can you infer from the following explain output?</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.tweets.find({"user.followers_count":{$gt:1000}}).sort({"created_at" : 1 }).limit(10).skip(5000).explain()
{
        "cursor" : "BtreeCursor created_at_-1 reverse",
        "isMultiKey" : false,
        "n" : 10,
        "nscannedObjects" : 46462,
        "nscanned" : 46462,
        "nscannedObjectsAllPlans" : 49763,
        "nscannedAllPlans" : 49763,
        "scanAndOrder" : false,
        "indexOnly" : false,
        "nYields" : 0,
        "nChunkSkips" : 0,
        "millis" : 205,
        "indexBounds" : {
                "created_at" : [
                        [
                                {
                                        "$minElement" : 1
                                },
                                {
                                        "$maxElement" : 1
                                }
                        ]
                ]
        },
        "server" : "localhost.localdomain:27017"
}</pre><p><a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=LrsbQkNztMY">Answer</a></p><div class="itemizedlist"><ul><li>This query performs a collection scan. <span class="strong"><strong>OK</strong></span></li><li>The query uses an index to determine the order in which to return result documents. <span class="strong"><strong>OK</strong></span></li><li>The query uses an index to determine which documents match.</li><li>The query returns 46462 documents.</li><li>The query visits 46462 documents. <span class="strong"><strong>OK</strong></span></li><li>The query is a "covered index query".</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_k_oxnc7vor8_hw_4_3_ulink"/>1.7.4.28. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=K-oXNC7voR8">HW 4.3</a></h4></div></div></div><p>Homework: HW 4.3</p><p>Making the Blog fast</p><p>Please download hw4-3.tgz or hw4-3.zip to get started. This assignment requires Mongo 2.2 or above.</p><p>In this homework assignment you will be adding some indexes to the post collection to make the blog fast.</p><p>We have provided the full code for the blog application and you don’t need to make any changes, or even run the blog. But you can, for fun.</p><p>We are also providing a patriotic (if you are an American) data set for the blog. There are 1000 entries with lots of comments and tags. You must load this dataset to complete the problem.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE"># from the mongo shell
use blog
db.posts.drop()
# from the terminal window
mongoimport -d blog -c posts &lt; posts.json</pre><p>The blog has been enhanced so that it can also display the top 10 most recent posts by tag.</p><p>There are hyperlinks from the post tags to the page that displays the 10 most recent blog entries for that tag. (run the blog and it will be obvious)</p><p>Your assignment is to make the following blog pages fast:</p><div class="itemizedlist"><ul><li>The blog home page</li><li>The page that displays blog posts by tag (<a class="ulink" href="http://localhost:8082/tag/whatever">http://localhost:8082/tag/whatever</a>)</li><li>The page that displays a blog entry by permalink (<a class="ulink" href="http://localhost:8082/post/permalink">http://localhost:8082/post/permalink</a>)</li></ul></div><p>By fast, we mean that indexes should be in place to satisfy these queries such that we only need to scan the number of documents we are going to return.</p><p>To figure out what queries you need to optimize, you can read the code and see what it does to display those pages. Isolate those queries and use explain to explore.</p><p>Once you have added the indexes to make those pages fast run the following.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">python validate.py</pre><p>(note that for folks who are using MongoLabs or MongoHQ there are some command line options to validate.py to make it possible to use those services) Now enter the validation code below.</p><p><a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=pDtSL7gbQa4">Answer</a></p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">34f9jr29sh29f20fsplinv</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__hw_4_4"/>1.7.4.29. [HW 4.4]</h4></div></div></div><p>Homework: HW 4.4</p><p>In this problem you will analyze a profile log taken from a mongoDB instance. To start, please download sysprofile.json and import it with the following command:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">mongoimport -d m101 -c profile &lt; sysprofile.json</pre><p>Now query the profile data, looking for all queries to the students collection in the database school2, sorted in order
of decreasing latency. What is the latency of the longest running operation to the collection, in milliseconds?</p><div class="itemizedlist"><ul><li>4715</li><li>34430</li><li>5018</li><li>15820</li><li>3217</li></ul></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="mongo-m101j-week5"/>1.7.5. WEEK 5 - AGGREGATION</h3></div></div></div><p>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_eaeihm3cmqm_introduction_to_aggregation_ulink"/>1.7.5.1. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=EaEIHm3CMQM">Introduction to Aggregation</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_t2bx_lzoysy_simple_aggregation_example_ulink"/>1.7.5.2. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=T2BX-LZOYsY">Simple Aggregation Example</a></h4></div></div></div><p>Quiz: Simple Aggregation Example. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=Nt0cQI86G40">Answer</a></p><p>Write the aggregation query that will find the number of products by category of a collection that has the form:
{
	"_id" : ObjectId("50b1aa983b3d0043b51b2c52"),
	"name" : "Nexus 7",
	"category" : "Tablets",
	"manufacturer" : "Google",
	"price" : 199
}</p><p>Have the resulting key be called "num_products," as in the video lesson. Hint, you just need to change which key you are aggregating on relative to the examples shown in the lesson.
Please double quote all keys to make it easier to check your result.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.products.aggregate([{$group:{"_id":"$category", "num_products":{"$sum":1}}}])</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_wazn2ds8s8c_the_aggregation_pipeline_ulink"/>1.7.5.3. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=WazN2DS8s8c">The Aggregation Pipeline</a></h4></div></div></div><p>Quiz: The Aggregation Pipeline. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=mcnGfI69rRc#t=0">Answer</a></p><p>Which of the following are stages in the aggregation pipeline. Check all that apply.</p><div class="itemizedlist"><ul><li>Match <span class="strong"><strong>OK</strong></span></li><li>Transpose <span class="strong"><strong>OK</strong></span></li><li>Group <span class="strong"><strong>OK</strong></span></li><li>Skip <span class="strong"><strong>OK</strong></span></li><li>Limit <span class="strong"><strong>OK</strong></span></li><li>Sort <span class="strong"><strong>OK</strong></span></li><li>Project <span class="strong"><strong>OK</strong></span></li><li>unwind <span class="strong"><strong>OK</strong></span></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_3lepnmcfpcs_simple_example_expanded_ulink"/>1.7.5.4. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=3lEpnMcfpCs">Simple Example Expanded</a></h4></div></div></div><p>Quiz: Simple Example Expanded. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=nr1E1qTyIHU">Answer</a></p><p>If you have the following collection of stuff:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">&gt; db.stuff.find()
{ "_id" : ObjectId("50b26f9d80a78af03b5163c8"), "a" : 1, "b" : 1, "c" : 1 }
{ "_id" : ObjectId("50b26fb480a78af03b5163c9"), "a" : 2, "b" : 2, "c" : 1 }
{ "_id" : ObjectId("50b26fbf80a78af03b5163ca"), "a" : 3, "b" : 3, "c" : 1 }
{ "_id" : ObjectId("50b26fcd80a78af03b5163cb"), "a" : 3, "b" : 3, "c" : 2 }
{ "_id" : ObjectId("50b26fd380a78af03b5163cc"), "a" : 3, "b" : 5, "c" : 3 }</pre><p>and you perform the following aggregation:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.stuff.aggregate([{$group:{_id:'$c'}}])</pre><p>How many documents will be in the result set from aggregate?</p><div class="itemizedlist"><ul><li>1</li><li>2</li><li>3 <span class="strong"><strong>OK</strong></span></li><li>4</li><li>5</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_lpfvrrag2zg_compound_grouping_ulink"/>1.7.5.5. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=LPFVRrag2Zg">Compound Grouping</a></h4></div></div></div><p>Quiz: Compound Grouping <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=bIlwnlYBRA0">Answer</a></p><p>Given the following collection:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">&gt; db.stuff.find()
{ "_id" : ObjectId("50b26f9d80a78af03b5163c8"), "a" : 1, "b" : 1, "c" : 1 }
{ "_id" : ObjectId("50b26fb480a78af03b5163c9"), "a" : 2, "b" : 2, "c" : 1 }
{ "_id" : ObjectId("50b26fbf80a78af03b5163ca"), "a" : 3, "b" : 3, "c" : 1 }
{ "_id" : ObjectId("50b26fcd80a78af03b5163cb"), "a" : 3, "b" : 3, "c" : 2 }
{ "_id" : ObjectId("50b26fd380a78af03b5163cc"), "a" : 3, "b" : 5, "c" : 3 }
{ "_id" : ObjectId("50b27f7080a78af03b5163cd"), "a" : 3, "b" : 3, "c" : 2 }</pre><p>And the following aggregation query:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.stuff.aggregate([{$group:
		     {_id:
		      {'moe':'$a',
		       'larry':'$b',
		       'curly':'$c'
		      }
		     }
		    }])</pre><p>How many documents will be in the result set?</p><div class="itemizedlist"><ul><li>2</li><li>3</li><li>4</li><li>5 <span class="strong"><strong>OK</strong></span></li><li>6</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_zon4cj_xqzy_using_a_document_for_id_ulink"/>1.7.5.6. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=zoN4cj_XQzY">Using a document for _id</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_l4g14mtftgq_aggregation_expressions_ulink"/>1.7.5.7. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=L4G14MTfTgQ">Aggregation Expressions</a></h4></div></div></div><p>Quiz: Aggregation Expressions. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=kJ0k2na4ukU">Answer</a></p><p>Which of the following aggregation expressions must be used in conjunction with a sort to make any sense?</p><div class="itemizedlist"><ul><li>$addToSet</li><li>$first <span class="strong"><strong>OK</strong></span></li><li>$last  <span class="strong"><strong>OK</strong></span></li><li>$max</li><li>$min</li><li>$avg</li><li>$push</li><li>$sum</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_oav9tc0r8xk_using_sum_ulink"/>1.7.5.8. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=oAV9tC0R8xk">Using $sum</a></h4></div></div></div><p>Quiz: Using $sum  <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=ATO_s_Ah08o">Answer</a></p><p>This problem, and some after it, use the zips collection from media.mongodb.org/zips.json.</p><p>You don’t need to download it, but you can if you want, allowing you to test your queries within MongoDB.</p><p>You can import, once downloaded, using mongoimport</p><p>Suppose we have a collection of populations by postal code.</p><p>The postal codes in are in the _id field, and are therefore unique. Documents look like this:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{
	"city" : "CLANTON",
	"loc" : [
		-86.642472,
		32.835532
	],
	"pop" : 13990,
	"state" : "AL",
	"_id" : "35045"
}</pre><p>For students outside the United States, there are 50 non-overlapping states in the US with two letter abbreviations such as NY and CA.
In addition, the capital of Washington is within an area designated the District of Columbia, and
carries the abbreviation DC. For purposes of the mail, the postal service considers DC to be a "state." So in this dataset,
there are 51 states. We call postal codes "zip codes." A city may overlap several zip codes.</p><p>Write an aggregation query to sum up the population (pop) by state and put the result in a field called population.</p><p>Don’t use a compound _id key (you don’t need one and the quiz checker is not expecting one).</p><p>The collection name is zips. so something along the lines of db.zips.aggregrate…</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.zips.aggregate([{"$group":{"_id":"$state", "population":{$sum:"$pop"}}}])</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_7uwok8rwf1w_using_avg_ulink"/>1.7.5.9. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=7UWOK8rWf1w">Using $avg</a></h4></div></div></div><p>Quiz: Using $avg <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=tT6Jx8s9dTc">Answer</a></p><p>This problem uses the same dataset as we described in using $sum quiz and you should review that quiz if you did not complete it.
Given population data by zip code (postal code) that looks like this:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{
	"city" : "FISHERS ISLAND",
	"loc" : [
		-72.017834,
		41.263934
	],
	"pop" : 329,
	"state" : "NY",
	"_id" : "06390"
}</pre><p>Write an aggregation expression to calculate the average population of a zip code (postal code) by state.</p><p>As before, the postal code is in the _id field and is unique.</p><p>The collection is assumed to be called "zips" and you should name the key in the result set "average_pop".</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.zips.aggregate([{"$group":{"_id":"$state", "average_pop":{"$avg":"$pop"}}}])</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_y2fd4r3in5u_using_addtoset_ulink"/>1.7.5.10. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=y2FD4R3in5U">Using $addToSet</a></h4></div></div></div><p>Quiz: Using $addToSet <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=zGcTxUQuLGE">Answer</a></p><p>This problem uses the same zip code data as the $using sum quiz. See that quiz for a longer explanation.
Suppose we population by zip code (postal code) data that looks like this (putting in a query for the zip codes in Palo Alto)</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">&gt; db.zips.find({state:"CA",city:"PALO ALTO"})
{ "city" : "PALO ALTO", "loc" : [ -122.149685, 37.444324 ], "pop" : 15965, "state" : "CA", "_id" : "94301" }
{ "city" : "PALO ALTO", "loc" : [ -122.184234, 37.433424 ], "pop" : 1835, "state" : "CA", "_id" : "94304" }
{ "city" : "PALO ALTO", "loc" : [ -122.127375, 37.418009 ], "pop" : 24309, "state" : "CA", "_id" : "94306" }</pre><p>Write an aggregation query that will return the postal codes that cover each city. The results should look like this:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{
			"_id" : "CENTREVILLE",
			"postal_codes" : [
				"22020",
				"49032",
				"39631",
				"21617",
				"35042"
			]
		},</pre><p>Again the collection will be called zips. You can deduce what your result column names should be from the above output.
(ignore the issue that a city may have the same name in two different states and is in fact two
different cities in that case - for eg Springfield, MO and Springfield, MA)</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.zips.aggregate([{"$group":{"_id":"$city", "postal_codes":{"$addToSet":"$_id"}}}])</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_gjivufufx3a_using_push_ulink"/>1.7.5.11. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=gjIVUFufx3A">Using $push</a></h4></div></div></div><p>Quiz: Using $push <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=hFqDvVXtm6E">Answer</a></p><p>Given the zipcode dataset (explained more fully in the using $sum quiz) that has documents that look like this:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">&gt; db.zips.findOne()
{
	"city" : "ACMAR",
	"loc" : [
		-86.51557,
		33.584132
	],
	"pop" : 6055,
	"state" : "AL",
	"_id" : "35004"
}</pre><p>would you expect the following two queries to produce the same result or different results?</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.zips.aggregate([{"$group":{"_id":"$city", "postal_codes":{"$push":"$_id"}}}])</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.zips.aggregate([{"$group":{"_id":"$city", "postal_codes":{"$addToSet":"$_id"}}}])</pre><div class="itemizedlist"><ul><li>Same result <span class="strong"><strong>OK</strong></span></li><li>Different Result</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_byonx4trjoq_using_max_and_min_ulink"/>1.7.5.12. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=BYoNX4trjOQ">Using $max and $min</a></h4></div></div></div><p>Quiz: Using $max and $min <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=sHCdOiCispA">Answer</a></p><p>Again thinking about the zip code database, write an aggregation query that will return the
population of the postal code in each state with the highest population.
It should return output that looks like this:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{
			"_id" : "WI",
			"pop" : 57187
		},
		{
			"_id" : "WV",
			"pop" : 70185
		},
..and so on</pre><p>Once again, the collection is named zips.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.zips.aggregate([{$group:{"_id":"$state", pop:{$max:"$pop"}}}])</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_et4ubwqttos_double_group_stages_ulink"/>1.7.5.13. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=ET4ubwQTTos">Double $group stages</a></h4></div></div></div><p>Quiz: Double $group stages. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=J-asAAEHJ0Q">Answer</a></p><p>Given the following collection:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">&gt; db.fun.find()
{ "_id" : 0, "a" : 0, "b" : 0, "c" : 21 }
{ "_id" : 1, "a" : 0, "b" : 0, "c" : 54 }
{ "_id" : 2, "a" : 0, "b" : 1, "c" : 52 }
{ "_id" : 3, "a" : 0, "b" : 1, "c" : 17 }
{ "_id" : 4, "a" : 1, "b" : 0, "c" : 22 }
{ "_id" : 5, "a" : 1, "b" : 0, "c" : 5 }
{ "_id" : 6, "a" : 1, "b" : 1, "c" : 87 }
{ "_id" : 7, "a" : 1, "b" : 1, "c" : 97 }</pre><p>And the following aggregation query</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.fun.aggregate([{$group:{_id:{a:"$a", b:"$b"}, c:{$max:"$c"}}}, {$group:{_id:"$_id.a", c:{$min:"$c"}}}])</pre><p>What values are returned?</p><div class="itemizedlist"><ul><li>17 and 54</li><li>97 and 21</li><li>54 and 5</li><li>52 and 22 <span class="strong"><strong>OK</strong></span></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_yi_yssno8ao_project_ulink"/>1.7.5.14. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=yi-ySSNO8Ao">$project</a></h4></div></div></div><p>Quiz: $project  <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=IGN0lXg-kJ0">Answer</a></p><p>Write an aggregation query with a single projection stage that will transform the documents in the zips collection from this:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{
	"city" : "ACMAR",
	"loc" : [
		-86.51557,
		33.584132
	],
	"pop" : 6055,
	"state" : "AL",
	"_id" : "35004"
}</pre><p>to documents in the result set that look like this:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{
	"city" : "acmar",
	"pop" : 6055,
	"state" : "AL",
	"zip" : "35004"
}</pre><p>So that the checker works properly, please specify what you want to do with the _id key as the first item.
The other items should be ordered as above. As before, assume the collection is called zips.
You are running only the projection part of the pipeline for this quiz.</p><p>A few facts not mentioned in the lesson that you will need to know to get this right:
If you don’t mention a key, it is not included, except for _id, which must be explicitly suppressed.
If you want to include a key exactly as it is named in the source document, you just write key:1,
where key is the name of the key. You will probably get more out of this quiz is you download the zips.json
file and practice in the shell. zips.json link is in the using $sum quiz</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.zips.aggregate([{$project:{_id:0, city:{$toLower:"$city"}, pop:1, state:1, zip:"$_id"}}])</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_qohlrl8k0so_match_ulink"/>1.7.5.15. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=qohLRL8k0So">$match</a></h4></div></div></div><p>Quiz: $match <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=CHGiumXE-pU">Answer</a></p><p>Again, thinking about the zipcode collection, write an aggregation query with a single match phase that filters
for zipcodes with greater than 100,000 people. You may need to look up the use of the
<a class="ulink" href="http://docs.mongodb.org/manual/reference/operators/">$gt operator in the MongoDB docs</a>.</p><p>Assume the collection is called zips.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.zips.aggregate([{$match:{pop:{$gt:100000}}}])</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_tw1kbyiuns4_sort_ulink"/>1.7.5.16. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=TW1KByIuns4">$sort</a></h4></div></div></div><p>Quiz: $sort <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=-cghyd6AHHA">Answer</a></p><p>Again, considering the zipcode collection, which has documents that look like this,</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{
	"city" : "ACMAR",
	"loc" : [
		-86.51557,
		33.584132
	],
	"pop" : 6055,
	"state" : "AL",
	"_id" : "35004"
}</pre><p>Write an aggregation query with just a sort stage to sort by (state, city), both ascending. Assume the collection is called zips.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.zips.aggregate([{$sort:{state:1, city:1}}])</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_adxoezvqdtc_limit_and_skip_ulink"/>1.7.5.17. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=AdxoEzVqdtc">$limit and $skip</a></h4></div></div></div><p>Quiz: $limit and $skip <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=joRw-fqCIWA">Answer</a></p><p>Suppose you change the order of skip and limit in the query shown in the lesson, to look like this:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.zips.aggregate([
    {$match:
     {
	 state:"NY"
     }
    },
    {$group:
     {
	 _id: "$city",
	 population: {$sum:"$pop"},
     }
    },
    {$project:
     {
	 _id: 0,
	 city: "$_id",
	 population: 1,
     }
    },
    {$sort:
     {
	 population:-1
     }
    },
    {$limit: 5},
    {$skip: 10}
])</pre><p>How many documents do you think will be in the result set?</p><div class="itemizedlist"><ul><li>10</li><li>5</li><li>0  <span class="strong"><strong>OK</strong></span></li><li>100</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_o1zeqaxdugk_revisiting_first_and_last_ulink"/>1.7.5.18. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=O1zeqAxdUgk">Revisiting $first and $last</a></h4></div></div></div><p>Quiz: Revisiting $first and $last <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=WBWb0ssDVeY">Answer</a></p><p>Given the following collection:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">&gt; db.fun.find()
{ "_id" : 0, "a" : 0, "b" : 0, "c" : 21 }
{ "_id" : 1, "a" : 0, "b" : 0, "c" : 54 }
{ "_id" : 2, "a" : 0, "b" : 1, "c" : 52 }
{ "_id" : 3, "a" : 0, "b" : 1, "c" : 17 }
{ "_id" : 4, "a" : 1, "b" : 0, "c" : 22 }
{ "_id" : 5, "a" : 1, "b" : 0, "c" : 5 }
{ "_id" : 6, "a" : 1, "b" : 1, "c" : 87 }
{ "_id" : 7, "a" : 1, "b" : 1, "c" : 97 }</pre><p>What would be the value of c in the result from this aggregation query</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.fun.aggregate([
    {$match:{a:0}},
    {$sort:{c:-1}},
    {$group:{_id:"$a", c:{$first:"$c"}}}
])</pre><div class="itemizedlist"><ul><li>21</li><li>54 <span class="strong"><strong>OK</strong></span></li><li>97</li><li>5</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_e4ayoqpeqvi_unwind_ulink"/>1.7.5.19. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=E4aYOQPeQvI">$unwind</a></h4></div></div></div><p>Quiz: $unwind <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=Xfl3m7wz8ts">Answer</a></p><p>Suppose you have the following collection:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.people.find()
{ "_id" : "Barack Obama", "likes" : [ "social justice", "health care", "taxes" ] }
{ "_id" : "Mitt Romney", "likes" : [ "a balanced budget", "corporations", "binders full of women" ] }</pre><p>And you unwind the "likes" array of each document. How many documents will you wind up with?</p><div class="itemizedlist"><ul><li>2</li><li>4</li><li>6 <span class="strong"><strong>OK</strong></span></li><li>9</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_xiwcjr4lqag_unwind_example_ulink"/>1.7.5.20. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=XiWCJr4Lqag">$unwind example</a></h4></div></div></div><p>Quiz: $unwind example <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=jAWL-BJD0tI">Answer</a></p><p>Which grouping operator will enable to you to reverse the effects of an unwind?</p><div class="itemizedlist"><ul><li>$sum</li><li>$addToSet</li><li>$push <span class="strong"><strong>OK</strong></span></li><li>$first</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_sgnidshyfeu_double_unwind_ulink"/>1.7.5.21. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=sgnidsHyFeU">Double $unwind</a></h4></div></div></div><p>Quiz: Double $unwind <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=pziFq1oVRI4">Answer</a></p><p>Can you reverse the effects of a double unwind (2 unwinds in a row) in our inventory collection (shown in the lesson ) with the $push operator?</p><div class="itemizedlist"><ul><li>Yes  <span class="strong"><strong>OK</strong></span></li><li>No</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_aul2r0xklym_mapping_between_sql_and_aggregation_ulink"/>1.7.5.22. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=auL2R0XKlyM">Mapping between SQL and Aggregation</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_ep2glsr6c0u_some_common_sql_examples_ulink"/>1.7.5.23. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=ep2gLSR6C0U">Some Common SQL examples</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_8bqzkxi_we_limitations_of_the_aggregation_framwork_ulink"/>1.7.5.24. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=8BQzKXI-_wE">Limitations of the Aggregation Framwork</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__hw_5_1"/>1.7.5.25. [HW 5.1]</h4></div></div></div><p>Homework: HW 5.1 <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=9wkTlkRZ8Z0">Answer</a></p><p>Finding the most frequent author of comments on your blog</p><p>In this assignment you will use the aggregation framework to find the most frequent author of comments on your blog.
We will be using the same dataset as last week.</p><p>Start by downloading the posts.json dataset from last week’s homework, found in
<a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/hw4-3.549d89fe98d1.tgz">hw4-3.tgz</a> or
<a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/hw4-3.de5d68fa4eec.zip">hw4-3.zip</a>.
Then import into your blog database as follows:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">mongoimport -d blog -c posts --drop &lt; posts.json</pre><p>Now use the aggregation framework to calculate the author with the greatest number of comments.</p><p>To help you verify your work before submitting, the author with the least comments is Efrain Claw and he commented 384 times.</p><p>Ok, please choose your answer below for the most prolific comment author:</p><div class="itemizedlist"><ul><li>Tonisha Games</li><li>Milan Mcgavock</li><li>Lucinda Vanderburg</li><li>Dusti Lemmond</li><li>Mikaela Meidinger <span class="strong"><strong>OK</strong></span></li><li>Corliss Zuk</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__hw_5_2_ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_vtsfb8m4vrs_answer_ulink"/>1.7.5.26. [HW 5.2] <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=VTSFb8m4vrs">Answer</a></h4></div></div></div><p>Crunching the Zipcode dataset</p><p>Please download the zips.json dataset and import it into a collection of your choice.</p><p>Please calculate the average population of cities in California (abbreviation CA) and New York (NY) (taken together) with populations over 25,000.</p><p>For this problem, assume that a city name that appears in more than one state represents two separate cities.</p><p>Please round the answer to a whole number.
Hint: The answer for CT and NJ is 49749.</p><div class="itemizedlist"><ul><li>78347</li><li>96343</li><li>86253</li><li>93164</li><li>82541 <span class="strong"><strong>OK</strong></span></li><li>68341</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__hw_5_3_ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_wqfqazhoie8_answer_ulink"/>1.7.5.27. [HW 5.3] <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=wqfqAzhOie8">Answer</a></h4></div></div></div><p><span class="strong"><strong>Who’s the easiest grader on campus?</strong></span></p><p>In this problem you will be analyzing a dataset of student grades. Please import grades_5-3.js into a database and collection of your choice.</p><p>The documents look like this:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{
	"_id" : ObjectId("50b59cd75bed76f46522c392"),
	"student_id" : 10,
	"class_id" : 5,
	"scores" : [
		{
			"type" : "exam",
			"score" : 69.17634380939022
		},
		{
			"type" : "quiz",
			"score" : 61.20182926719762
		},
		{
			"type" : "homework",
			"score" : 73.3293624199466
		},
		{
			"type" : "homework",
			"score" : 15.206314042622903
		},
		{
			"type" : "homework",
			"score" : 36.75297723087603
		},
		{
			"type" : "homework",
			"score" : 64.42913107330241
		}
	]
}</pre><p>There are documents for each student (student_id) across a variety of classes (class_id).
Note that not all students in the same class have the same exact number of assessments.
Some students have three homework assignments, etc.</p><p>Your task is to calculate the class with the best average student performance.
This involves calculating an average for each student in each class of all non-quiz assessments and then averaging
those numbers to get a class average. To be clear, each student’s average includes
only exams and homework grades. <span class="strong"><strong>Don’t include their quiz scores in the calculation.</strong></span></p><p>What is the class_id which has the highest average student perfomance?</p><p>Hint/Strategy: You need to group twice to solve this problem.
You must figure out the GPA that each student has achieved in a class and then average those numbers to get a class average.
After that, you just need to sort. The hardest class is class_id=2. Those students achieved a class average of 37.6</p><p>Below, choose the class_id with the highest average student average.</p><div class="itemizedlist"><ul><li>8</li><li>9</li><li>1 <span class="strong"><strong>OK</strong></span></li><li>5</li><li>7</li><li>0</li><li>6</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__hw_5_4_ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_upwiqjro2vw_answer_ulink"/>1.7.5.28. [HW 5.4] <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=UpwIQjRO2vw">Answer</a></h4></div></div></div><p><span class="strong"><strong>Removing Rural Residents</strong></span> In this problem you will calculate the number of people who live in a zip code in the US
where the city starts with a digit. We will take that to mean they don’t really live in a city.
Once again, you will be using the zip code collection you imported earlier.</p><p>The project operator can extract the first digit from any field. For example,
to extract the first digit from the city field, you could write this query:</p><p>The project operator can extract the first digit from any field. For example,
to extract the first digit from the city field, you could write this query:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.zips.aggregate([
    {$project:
     {
	first_char: {$substr : ["$city",0,1]},
     }
   }
])</pre><p>Using the aggregation framework, calculate the sum total of people who are living in a zip code where the city starts with a digit. Choose the answer below.</p><p>Note that you will need to probably change your projection to send more info through than just that first character.
Also, you will need a filtering step to get rid of all documents where the city does not start with a digital (0-9).</p><div class="itemizedlist"><ul><li>298015 <span class="strong"><strong>OK</strong></span></li><li>345232</li><li>245987</li><li>312893</li><li>158249</li><li>543282</li></ul></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="mongo-m101j-week6"/>1.7.6. WEEK 6 - APPLICATION ENGINEERING</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_3zcbhnhebac_introduction_ulink"/>1.7.6.1. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=3zcbhNHebAc">Introduction</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_etepekx3koo_write_concern_ulink"/>1.7.6.2. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=EtEPEkX3koo">Write Concern</a></h4></div></div></div><p>Quiz: Write Concern. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=2-UO105PDrk">Answer</a></p><p>Provided you assume that the disk is persistent, what are the w and j settings required to guarantee that an insert or update has been written all the way to disk.</p><div class="itemizedlist"><ul><li>w=0, j=0</li><li>w=1, j=1 <span class="strong"><strong>OK</strong></span></li><li>w=2, j=0</li><li>w=1, j=0</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_bycnyxfpqhm_network_errors_ulink"/>1.7.6.3. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=BycNYXFpqhM">Network Errors</a></h4></div></div></div><p>Quiz: Network Errors. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=64mAA3SEnkg">Answer</a></p><p>What are the reasons why an application may receive an error back even if the write was successful. Check all that apply.</p><div class="itemizedlist"><ul><li>The network TCP network connection between the application and the server was reset between the time of the write and the time of the getLastError call. <span class="strong"><strong>OK</strong></span></li><li>The MongoDB server terminates between the write and the getLastError call. <span class="strong"><strong>OK</strong></span></li><li>The network fails between the time of the write and the time of the getLastError call.  <span class="strong"><strong>OK</strong></span></li><li>The write violates a primary key constraint on the collection and must be rolled back.  <span class="strong"><strong>OK</strong></span></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_h1zglx8ggxk_the_pymongo_driver_ulink"/>1.7.6.4. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=H1zGLx8ggXk">The Pymongo Driver</a></h4></div></div></div><p>Quiz: The Pymongo Driver</p><p>In the 2.4 release of Pymongo, a new connection class is introduced that automatically sets w=1, j=0. It essentially defaults to what
used to be called safe mode and replaces the old Connection class. What is the name of that class?</p><div class="itemizedlist"><ul><li>MongoSafe</li><li>SafeConnection</li><li>MongoClient <span class="strong"><strong>OK</strong></span></li><li>FireAndRemember</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_f1wtygoru3w_introduction_to_replication_ulink"/>1.7.6.5. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=f1WTYGORU3w">Introduction to Replication</a></h4></div></div></div><p>Quiz: Introduction to Replication. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=XCssKzhlnZU">Answer</a></p><p>What is the minimum original number of nodes needed to assure the election of a new Primary if a node goes down?</p><div class="itemizedlist"><ul><li>1</li><li>2</li><li>3 <span class="strong"><strong>OK</strong></span></li><li>5</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_wfxsvho78bq_replica_set_elections_ulink"/>1.7.6.6. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=WFXSVHO78bQ">Replica Set Elections</a></h4></div></div></div><p>Quiz: Replica Set Elections. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=vrUxTTD-XwA">Answer</a></p><p>Which types of nodes can participate in elections of a new primary?</p><div class="itemizedlist"><ul><li>Regular replica set members <span class="strong"><strong>OK</strong></span></li><li>Hidden Members <span class="strong"><strong>OK</strong></span></li><li>Arbiters <span class="strong"><strong>OK</strong></span></li><li>Lawyers</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_oqf_eza_s1m_write_consistency_ulink"/>1.7.6.7. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=Oqf_Eza-s1M">Write Consistency</a></h4></div></div></div><p>Quiz: Write Consistency. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=SjaJEYK1u3E">Answer</a></p><p>During the time when failover is occurring, can writes successfully complete?</p><p>Yes</p><p>No <span class="strong"><strong>OK</strong></span></p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_flcfvfbrski_creating_a_replica_set_ulink"/>1.7.6.8. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=flCFVFBRsKI">Creating a Replica Set</a></h4></div></div></div><p>Quiz: Creating a Replica Set <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=ibZVf59aUj8">Answer</a></p><p>Which command, when issued from the mongo shell, will allow you to read from a secondary?</p><div class="itemizedlist"><ul><li>db.isMaster()</li><li>db.adminCommand({<span class="emphasis"><em>readPreference</em></span>:'Secondary'})</li><li>rs.setStatus("Primary")</li><li>rs.slaveOk() <span class="strong"><strong>OK</strong></span></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_lx0kj4n4ewm_replica_set_internals_ulink"/>1.7.6.9. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=lx0Kj4n4EWM">Replica Set Internals</a></h4></div></div></div><p>Quiz: Replica Set Internals <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=_am2mdVF1uk">Answer</a></p><p>In the video how long did it take to elect a new primary?</p><div class="itemizedlist"><ul><li>About three seconds <span class="strong"><strong>OK</strong></span></li><li>Above 10 seconds</li><li>About 30 seconds</li><li>About a minute</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_iw1ow_adlt0_failover_and_rollback_ulink"/>1.7.6.10. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=IW1oW_Adlt0">Failover and Rollback</a></h4></div></div></div><p>Quiz: Failover and Rollback <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=t3rNxRg6WZE">Answer</a></p><p>What happens if a node comes back up as a secondary after a period of being offline and the oplog has looped on the primary?</p><div class="itemizedlist"><ul><li>The entire dataset will be copied from the primary <span class="strong"><strong>OK</strong></span></li><li>A rollback will occur</li><li>The new node stays offline (does not re-join the replica set)</li><li>The new node begins to calculate Pi to a large number of decimal places</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_gl4kika730k_connecting_to_a_replica_set_from_pymongo_ulink"/>1.7.6.11. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=GL4kika730k">Connecting to a Replica Set from Pymongo</a></h4></div></div></div><p>Quiz: Connecting to a Replica Set from Java Driver <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=E5vOOKL45pc">Answer</a></p><p>If you leave a replica set node out of the seedlist within the driver, what will happen?</p><div class="itemizedlist"><ul><li>The missing node will not be used by the application.</li><li>The missing node will be discovered as long as you list at least one valid node. <span class="strong"><strong>OK</strong></span></li><li>This missing node will be used for reads, but not for writes.</li><li>The missing node will be used for writes, but not for reads.</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_0aniusyhg9k_bad_things_happen_to_good_nodes_ulink"/>1.7.6.12. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=0ANiUSyhG9k">Bad Things Happen to Good Nodes</a></h4></div></div></div><p>Quiz: Bad Things Happen to Good Nodes <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=VmVINcX3zQs">Answer</a></p><p>If you use the special MongoReplicaSetClient, are you guaranteed to avoid a network error due an intervening failover?</p><div class="itemizedlist"><ul><li>Yes</li><li>No <span class="strong"><strong>OK</strong></span></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_352e66zg0ou_write_concern_revisited_ulink"/>1.7.6.13. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=352E66ZG0OU">Write Concern Revisited</a></h4></div></div></div><p>Quiz: Write Concern <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=352E66ZG0OU">Answer</a></p><p>What are the w and j settings required to guarantee that an insert, update or delete has been persisted to disk?</p><div class="itemizedlist"><ul><li>w=0, j=0</li><li>w=1, j=1 <span class="strong"><strong>OK</strong></span></li><li>w=2, j=0</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_64maa3senkg_network_errors_ulink"/>1.7.6.14. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=64mAA3SEnkg">Network Errors</a></h4></div></div></div><p>Quiz: Network Errors <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=64mAA3SEnkg">Answer</a></p><p>What are the reasons why an application may receive an error back even if the write was successful. Check all that apply.</p><div class="itemizedlist"><ul><li>The network TCP network connection between the application and the server was reset between the time
of the write and the time of the getLastError call.</li><li>The MongoDB server terminates between the write and the getLastError call. <span class="strong"><strong>OK</strong></span></li><li>The network fails between the time of the write and the time of the getLastError call <span class="strong"><strong>OK</strong></span></li><li>The write violates a primary key constraint on the collection and must be rolled back. <span class="strong"><strong>OK</strong></span></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_la9uietvfwo_read_preferences_ulink"/>1.7.6.15. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=lA9UIEtvfWo">Read Preferences</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_gfdqa1qrl0_introduction_to_sharding_ulink"/>1.7.6.16. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=_GfDqa1qRl0">Introduction to Sharding</a></h4></div></div></div><p>Quiz: Introduction to Sharding <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=4Z0D2bX5Cg4">Answer</a></p><p>If the shard key is not include in a find operation and there are 3 shards, each one a replica set
with 3 nodes, how many nodes will see the find operation?</p><div class="itemizedlist"><ul><li>1</li><li>3 <span class="strong"><strong>OK</strong></span></li><li>9</li><li>6</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_aayc2w4kef4_building_a_sharded_environment_ulink"/>1.7.6.17. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=aaYc2W4keF4">Building a Sharded Environment</a></h4></div></div></div><p>Quiz: Building a Sharded Environment. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=5tPjnJrY0rU">Answer</a></p><p>If you want to build a production system with two shards, each one a replica set with three nodes, how may mongod processes must you start?</p><div class="itemizedlist"><ul><li>2</li><li>6</li><li>7</li><li>9 <span class="strong"><strong>OK</strong></span></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_ig278f60gra_implications_of_sharding_ulink"/>1.7.6.18. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=ig278F60gRA">Implications of Sharding</a></h4></div></div></div><p>Quiz: Implications of Sharding <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=vfl0hqdgB3Q">Answer</a></p><p>Suppose you wanted to shard the zip code collection after importing it. You want to shard on zip code. What index would be required to allow MongoDB to shard on zip code?</p><div class="itemizedlist"><ul><li>An index on zip or a non-multi-key index that starts with zip. <span class="strong"><strong>OK</strong></span></li><li>No index is required to use zip as the shard key.</li><li>A unique index on the zip code.</li><li>Any index that that includes the zip code.</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_rtyrlb1bgy_sharding_replication_ulink"/>1.7.6.19. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=-rtYrLb1bgY">Sharding + Replication</a></h4></div></div></div><p>Quiz: Sharding + Replication <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=hnuiYokdO7g">Answer</a></p><p>Suppose you want to run multiple mongos routers for redundancy. What level of the stack will assure that you can failover to a different mongos from within your application?</p><div class="itemizedlist"><ul><li>mongod</li><li>mongos</li><li>drivers <span class="strong"><strong>OK</strong></span></li><li>sharding config servers</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_8q2gb3qsbsi_choosing_a_shard_key_ulink"/>1.7.6.20. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=8q2GB3QSBSI">Choosing a Shard Key</a></h4></div></div></div><p>Quiz: Choosing a Shard Key</p><p>You are building a facebook competitor called footbook that will be a mobile social network of feet.
You have decided that your primary data structure for posts to the wall will look like this:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{'username':'toeguy',
     'posttime':ISODate("2012-12-02T23:12:23Z"),
     "randomthought": "I am looking at my feet right now",
     'visible_to':['friends','family', 'walkers']}</pre><p>Thinking about the tradeoffs of shard key selection, select the true statements below.</p><div class="itemizedlist"><ul><li>Choosing posttime as the shard key will cause hotspotting as time progresses. <span class="strong"><strong>OK</strong></span></li><li>Choosing username as the shard key will distribute posts to the wall well across the shards. <span class="strong"><strong>OK</strong></span></li><li>Choosing visible_to as a shard key is illegal.  <span class="strong"><strong>OK</strong></span></li><li>Choosing posttime as the shard key suffers from low cardinality.</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__hw_6_1_ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_j4zuf8ujd9s_answer_ulink"/>1.7.6.21. [HW 6.1] <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=J4ZuF8UJD9s">Answer</a></h4></div></div></div><p>Which of the following statements are true about MongoDB replication. Check all that apply.</p><div class="itemizedlist"><ul><li>The minimum sensible number of voting nodes to a replica set is three.</li><li>MongoDB replication is synchronous.</li><li>The Mongo shell is capable of attaching to a replica set and automatically failing over.</li><li>By default, using the new MongoClient connection class, w=1 and j=1.</li><li>The oplog utilizes a capped collection.</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__hw_6_2_ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_8k_6jprvkes_answer_ulink"/>1.7.6.22. [HW 6.2] <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=8K-6JPrvkEs">Answer</a></h4></div></div></div><p>Let’s suppose you have a five member replica set and want to assure that writes are committed to the journal and are
acknowledged by at least 3 nodes before you proceed forward. What would be the appropriate settings for w and j?</p><div class="itemizedlist"><ul><li>w=1, j=1</li><li>w="majority", j=1 <span class="strong"><strong>OK</strong></span></li><li>w=3, j=0</li><li>w=5, j=1</li><li>w=1,j=3</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__hw_6_3_ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_496qtqt4tx8_answer_ulink"/>1.7.6.23. [HW 6.3] <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=496QtQt4tX8">Answer</a></h4></div></div></div><p>Which of the following statements are true about choosing and using a shard key:</p><div class="itemizedlist"><ul><li>The shard key must be unique</li><li>There must be a index on the collection that starts with the shard key. <span class="strong"><strong>OK</strong></span></li><li>Mongo can not enforce unique indexes on a sharded collection other than the shard key itself. <span class="strong"><strong>OK</strong></span></li><li>Any update that does not contain the shard key will be sent to all shards. <span class="strong"><strong>OK</strong></span></li><li>You can change the shard key on a collection if you desire.</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__hw_6_4_ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_ueemjo9s7vq_answer_ulink"/>1.7.6.24. [HW 6.4] <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=uEemjO9S7vQ">Answer</a></h4></div></div></div><p>You have a sharded system with three shards and have sharded the collections "grades" in the "test" database across
those shards. The output of sh.status() when connected to mongos looks like this:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">mongos&gt; sh.status()
--- Sharding Status ---
  sharding version: { "_id" : 1, "version" : 3 }
  shards:
	{  "_id" : "s0",  "host" : "s0/localhost:37017,localhost:37018,localhost:37019" }
	{  "_id" : "s1",  "host" : "s1/localhost:47017,localhost:47018,localhost:47019" }
	{  "_id" : "s2",  "host" : "s2/localhost:57017,localhost:57018,localhost:57019" }
  databases:
	{  "_id" : "admin",  "partitioned" : false,  "primary" : "config" }
	{  "_id" : "test",  "partitioned" : true,  "primary" : "s0" }
		test.grades chunks:
				s1	4
				s0	4
				s2	4
			{ "student_id" : { $minKey : 1 } } --&gt;&gt; { "student_id" : 0 } on : s1 Timestamp(12000, 0)
			{ "student_id" : 0 } --&gt;&gt; { "student_id" : 2640 } on : s0 Timestamp(11000, 1)
			{ "student_id" : 2640 } --&gt;&gt; { "student_id" : 91918 } on : s1 Timestamp(10000, 1)
			{ "student_id" : 91918 } --&gt;&gt; { "student_id" : 176201 } on : s0 Timestamp(4000, 2)
			{ "student_id" : 176201 } --&gt;&gt; { "student_id" : 256639 } on : s2 Timestamp(12000, 1)
			{ "student_id" : 256639 } --&gt;&gt; { "student_id" : 344351 } on : s2 Timestamp(6000, 2)
			{ "student_id" : 344351 } --&gt;&gt; { "student_id" : 424983 } on : s0 Timestamp(7000, 2)
			{ "student_id" : 424983 } --&gt;&gt; { "student_id" : 509266 } on : s1 Timestamp(8000, 2)
			{ "student_id" : 509266 } --&gt;&gt; { "student_id" : 596849 } on : s1 Timestamp(9000, 2)
			{ "student_id" : 596849 } --&gt;&gt; { "student_id" : 772260 } on : s0 Timestamp(10000, 2)
			{ "student_id" : 772260 } --&gt;&gt; { "student_id" : 945802 } on : s2 Timestamp(11000, 2)
			{ "student_id" : 945802 } --&gt;&gt; { "student_id" : { $maxKey : 1 } } on : s2 Timestamp(11000, 3)</pre><p>If you ran the query</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">use test
db.grades.find({'student_id':530289})</pre><p>Which shards would be involved in answering the query?</p><div class="itemizedlist"><ul><li>s0,s1 and s2</li><li>s0</li><li>s1 <span class="strong"><strong>OK</strong></span></li><li>s2</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__hw_6_5"/>1.7.6.25. [HW 6.5]</h4></div></div></div><p>In this homework you will build a small replica set on your own computer. We will check that it works with validate.py,
which you should download in
[week6-lessons.tar] or
[week6-lessons.zip].</p><p>Create three directories for the three mongod processes. On unix, this could be done as follows:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">mkdir -p /data/rs1 /data/rs2 /data/rs3</pre><p>Now start three mongo instances as follows. Note that are three commands. The browser is probably wrapping them visually.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">mongod --replSet m101 --logpath "1.log" --dbpath /data/rs1 --port 27017 --smallfiles --oplogSize 64 --fork

mongod --replSet m101 --logpath "2.log" --dbpath /data/rs2 --port 27018 --smallfiles --oplogSize 64 --fork

mongod --replSet m101 --logpath "3.log" --dbpath /data/rs3 --port 27019 --smallfiles --oplogSize 64 --fork</pre><p>Now connect to a mongo shell and make sure it comes up</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">mongo --port 27017</pre><p>Now you will create the replica set. Type the following commands into the mongo shell:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">config = { _id: "m101", members:[
          { _id : 0, host : "localhost:27017"},
          { _id : 1, host : "localhost:27018"},
          { _id : 2, host : "localhost:27019"} ]
};
rs.initiate(config);</pre><p>At this point, the replica set should be coming up. You can type</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">rs.status()</pre><p>to see the state of replication.</p><p>Now run validate.py to confirm that it works.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">CongratsYouRock2012</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="mongo-m101j-week7"/>1.7.7. WEEK 7 - CASE STUDIES</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_adryiudsgv0_introduction_ulink"/>1.7.7.1. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=adRyiudsgv0">Introduction</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_gbauy0o_wzs_interview_with_jon_hoffman_foursquare_ulink"/>1.7.7.2. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=GBauy0o-Wzs">Interview with Jon Hoffman, foursquare</a></h4></div></div></div><p>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_rkpmvqnesza_interview_with_ryan_bubinski_codecademy_ulink"/>1.7.7.3. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=RkPmVQNesZA">Interview with Ryan Bubinski, Codecademy</a></h4></div></div></div><p>.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="mongo-m101j-final"/>1.7.8. FINAL EXAM</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__question_1_ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_kv80ih9thk4_answer_ulink"/>1.7.8.1. [Question 1] <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=Kv80ih9thK4">Answer</a></h4></div></div></div><p>Please download the Enron email dataset enron.zip, unzip it and then restore it using mongorestore. It should restore
to a collection called "messages" in a database called "enron". Note that this is an abbreviated version of the full corpus.
There should be 120,477 documents after restore.</p><p>Inspect a few of the documents to get a basic understanding of the structure.
Enron was an American corporation that engaged in a widespread accounting fraud and subsequently failed.</p><p>In this dataset, each document is an email message. Like all Email messages, there is one sender but there can be multiple recipients.</p><p>Construct a query to calculate the number of messages sent by Andrew Fastow, CFO, to Jeff Skilling,
the president. Andrew Fastow’s email addess was <a class="ulink" href="mailto:andrew.fastow@enron.com">andrew.fastow@enron.com</a>. Jeff Skilling’s email was <a class="ulink" href="mailto:jeff.skilling@enron.com">jeff.skilling@enron.com</a>.</p><p>For reference, the number of email messages from Andrew Fastow to John Lavorato (<a class="ulink" href="mailto:john.lavorato@enron.com">john.lavorato@enron.com</a>) was 1.</p><div class="itemizedlist"><ul><li>1</li><li>3 <span class="strong"><strong>OK</strong></span></li><li>5</li><li>7</li><li>9</li><li>12</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__question_2_ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_bygi51m_k8_answer_ulink"/>1.7.8.2. [Question 2] <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=bYgI51M__k8">Answer</a></h4></div></div></div><p>Please use the Enron dataset you imported for the previous problem. For this question you will use the
aggregation framework to figure out pairs of people that tend to communicate a lot.
To do this, you will need to unwind the To list for each message.</p><p>This problem is a little tricky because a recipient may appear more than once in the To list for a message.
You will need to fix that in a stage of the aggregation before doing your grouping and counting of (sender, recipient) pairs.</p><div class="itemizedlist"><ul><li><a class="ulink" href="mailto:susan.mara@enron.com">susan.mara@enron.com</a> to <a class="ulink" href="mailto:james.steffes@enron.com">james.steffes@enron.com</a></li><li><a class="ulink" href="mailto:susan.mara@enron.com">susan.mara@enron.com</a> to <a class="ulink" href="mailto:richard.shapiro@enron.com">richard.shapiro@enron.com</a></li><li><a class="ulink" href="mailto:soblander@carrfut.com">soblander@carrfut.com</a> to <a class="ulink" href="mailto:soblander@carrfut.com">soblander@carrfut.com</a></li><li><a class="ulink" href="mailto:susan.mara@enron.com">susan.mara@enron.com</a> to <a class="ulink" href="mailto:jeff.dasovich@enron.com">jeff.dasovich@enron.com</a> <span class="strong"><strong>OK</strong></span></li><li><a class="ulink" href="mailto:evelyn.metoyer@enron.com">evelyn.metoyer@enron.com</a> to <a class="ulink" href="mailto:kate.symes@enron.com">kate.symes@enron.com</a></li><li><a class="ulink" href="mailto:susan.mara@enron.com">susan.mara@enron.com</a> to <a class="ulink" href="mailto:alan.comnes@enron.com">alan.comnes@enron.com</a></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__question_3_ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_tg_i_vunwjk_answer_ulink"/>1.7.8.3. [Question 3]  <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=tg-I-VuNWjk">Answer</a></h4></div></div></div><p>In this problem you will update a document in the Enron dataset to illustrate your mastery of updating documents from the shell.</p><p>Please add the email address "<a class="ulink" href="mailto:mrpotatohead@10gen.com">mrpotatohead@10gen.com</a>" to the list of addresses in the "headers.To" array for the document
with "headers.Message-ID" of "&lt;8147308.1075851042335.JavaMail.evans@thyme&gt;"</p><p>After you have completed that task, please run final3-validate.py to get the validation code and put it in
the box below without any extra spaces. The validation script assumes that it is connecting to a simple
mongo instance on the standard port on localhost.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">897h6723ghf25gd87gh28</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_e7_wllwkp00_question_4_ulink_ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_vvkcuuqkdpg_answer_ulink"/>1.7.8.4. <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=E7-wlLWkP00">Question 4</a> <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=VvKCUuqKdpg">Answer</a></h4></div></div></div><p><span class="strong"><strong>Enhancing the Blog to support viewers liking certain comments</strong></span>
In this problem, you will be enhancing the blog project to support users liking certain
comments and the like counts showing up the in the permalink page.</p><p>Start by downloading the code in
<a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/final-problem4.03d4951e04c9.tar">final-problem4.tar or</a>
<a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/final-problem4.da61cb5b1c65.zip">final-problem4.zip</a>  and loading up the
blog dataset <a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/posts.f52bca51f2fb.json">posts.json.</a></p><p>The user interface has already been implemented for you. It’s not fancy. The /post URL shows the like counts next to each
comment and displays a Like button that you can click on. That Like button POSTS to the /like URL on the
blog, makes the necessary changes to the database state (you are implementing this), and then redirects the browser back to the permalink page.</p><p>This full round trip and redisplay of the entire web page is not how you would implement liking in a modern web app, but it makes
it easier for us to reason about, so we will go with it.</p><p>Your job is to search the code for the string "XXX work here" and make the necessary changes. You can choose whatever
schema you want, but you should note that the entry_template makes some assumptions about the how the like value will be
encoded and if you go with a different convention than it assumes, you will need to make some adjustments.</p><p>It is possible to solve this problem by putting NOTHING in one of the XXX spots and adding only a SINGLE LINE to the other
spot to properly increment the like count. If you decide to use a different schema than the entry_template is expecting,
then you will likely to work in both spots. The validation script does not look at the database. It looks at the blog.</p><p>The validation script, <a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/final4-validate.088b6d79b044.py">final4-validate.py</a></p><p>will fetch your blog, go to the first post’s permalink page and attempt to increment the vote count. You run it as follows:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">python final4-validate.py</pre><p>Remember that the blog needs to be running as well as Mongo. The validation script takes some options if you want to run outside of localhost.</p><p>After you have gotten it working, enter the validation string below.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">983nf93ncafjn20fn10f</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__question_5_ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_thmja11iekg_answer_ulink"/>1.7.8.5. [Question 5] <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=tHMJa11iekg">Answer</a></h4></div></div></div><p>Suppose your have a collection fubar with the following indexes created:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">[
	{
		"v" : 1,
		"key" : {
			"_id" : 1
		},
		"ns" : "test.fubar",
		"name" : "_id_"
	},
	{
		"v" : 1,
		"key" : {
			"a" : 1,
			"b" : 1
		},
		"ns" : "test.fubar",
		"name" : "a_1_b_1"
	},
	{
		"v" : 1,
		"key" : {
			"a" : 1,
			"c" : 1
		},
		"ns" : "test.fubar",
		"name" : "a_1_c_1"
	},
	{
		"v" : 1,
		"key" : {
			"c" : 1
		},
		"ns" : "test.fubar",
		"name" : "c_1"
	},
	{
		"v" : 1,
		"key" : {
			"a" : 1,
			"b" : 1,
			"c" : -1
		},
		"ns" : "test.fubar",
		"name" : "a_1_b_1_c_-1"
	}
]</pre><p>Now suppose you want to run the following query against the collection.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.fubar.find({'a':{'$lt':10000}, 'b':{'$gt': 5000}}, {'a':1, 'c':1}).sort({'c':-1})</pre><p>Which of the following indexes could be used by MongoDB to assist in answering the query. Check all that apply.</p><div class="itemizedlist"><ul><li><span class="emphasis"><em>id</em></span></li><li>a_1_b_1 <span class="strong"><strong>OK</strong></span></li><li>a_1_c_1 <span class="strong"><strong>OK</strong></span></li><li>c_1 <span class="strong"><strong>OK</strong></span></li><li>a_1_b_1_c_-1 <span class="strong"><strong>OK</strong></span></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__question_6_ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_7mzfnra_ya8_answer_ulink"/>1.7.8.6. [Question 6] <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=7mZFnrA_ya8">Answer</a></h4></div></div></div><p>Suppose you have a collection of students of the following form:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{
	"_id" : ObjectId("50c598f582094fb5f92efb96"),
	"first_name" : "John",
	"last_name" : "Doe",
	"date_of_admission" : ISODate("2010-02-21T05:00:00Z"),
	"residence_hall" : "Fairweather",
	"has_car" : true,
	"student_id" : "2348023902",
	"current_classes" : [
		"His343",
		"Math234",
		"Phy123",
		"Art232"
	]
}</pre><p>Now suppose that basic inserts into the collection, which only include the last name, first name and student_id,
are too slow. What could potentially improve the speed of inserts. Check all that apply.</p><div class="itemizedlist"><ul><li>Add an index on last_name, first_name if one does not already exist.</li><li>Set w=0, j=0 on writes <span class="strong"><strong>OK</strong></span></li><li>Provide a hint to MongoDB that it should not use an index for the inserts</li><li>Remove all indexes from the collection <span class="strong"><strong>OK</strong></span></li><li>Build a replica set and insert data into the secondary nodes to free up the primary nodes.</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__question_7"/>1.7.8.7. [Question 7]</h4></div></div></div><p>You have been tasked to cleanup a photosharing database. The database consists of two collections, albums, and images.
Every image is supposed to be in an album, but there are orphan images that appear in no album. Here are some example
documents (not from the collections you will be downloading).</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">&gt; db.albums.findOne()
{
	"_id" : 67
	"images" : [
		4745,
		7651,
		15247,
		17517,
		17853,
		20529,
		22640,
		27299,
		27997,
		32930,
		35591,
		48969,
		52901,
		57320,
		96342,
		99705
	]
}

&gt; db.images.findOne()
{ "_id" : 99705, "height" : 480, "width" : 640 }
&gt;</pre><p>From the above, you can conclude that the image with _id = 99705 is in album 67. It is not an orphan.</p><p>Your task is to write a program to remove every image from the images collection that appears in no album.
Or put another way, if an image does not appear in at least one album, it’s an orphan and should be removed from the images collection.</p><p>Start by using mongoimport to import your
<a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/albums.be1e0dcfa853.json">albums.json</a>] and
<a class="ulink" href="https://education.mongodb.com/static/m101j-october-2013/handouts/images.26c54434bf59.json">images.json</a> collections.(Did you notice the links in the previous sentence?)</p><p>When you are done removing the orphan images from the collection, there should be 90,017 documents in the images collection.
To prove you did it correctly, what are the total number of images with the tag <span class="emphasis"><em>sunrises" after the removal of orphans? As as a sanity
check, there are 50,054 images that are tagged 'sunrises</em></span> before you remove the images.
Hint: you might consider creating an index or two or your program will take a long time to run.</p><div class="itemizedlist"><ul><li>43,434</li><li>34,204</li><li>49,123</li><li>45,044 <span class="strong"><strong>OK</strong></span></li><li>50,054</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__question_8"/>1.7.8.8. [Question 8]</h4></div></div></div><p>Supposed we executed the following Java code. How many animals will be inserted into the "animals" collection?</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">public class Question8 {



        public static void main(String[] args) throws IOException {
            MongoClient c =  new MongoClient(new MongoClientURI("mongodb://localhost"));
            DB db = c.getDB("test");
            DBCollection animals = db.getCollection("animals");


            BasicDBObject animal = new BasicDBObject("animal", "monkey");

            animals.insert(animal);
            animal.removeField("animal");
            animal.append("animal", "cat");
            animals.insert(animal);
            animal.removeField("animal");
            animal.append("animal", "lion");
            animals.insert(animal);

        }

}</pre><div class="itemizedlist"><ul><li>0</li><li>1 <span class="strong"><strong>OK</strong></span></li><li>2</li><li>3</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__question_9_ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_cquxunbgggc_answer_ulink"/>1.7.8.9. [Question 9] <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=cqUxuNbGGGc">Answer</a></h4></div></div></div><p>Imagine an electronic medical record database designed to hold the medical records of every individual in the United States.
Because each person has more than 16MB of medical history and records, it’s not feasible to have a single document for every patient.
Instead, there is a patient collection that contains basic information on each person and maps the person to a patient_id, and a
record collection that contains one document for each test or procedure. One patient may have dozens or even hundreds of
documents in the record collection.</p><p>We need to decide on a shard key to shard the record collection. What’s the best shard key for the record collection, provided that we are
willing to run scatter gather operations to do research and run studies on various diseases and cohorts? That is, think mostly
about the operational aspects of such a system.</p><div class="itemizedlist"><ul><li>patient_id <span class="strong"><strong>OK</strong></span></li><li>_id</li><li>primary care physican (your principal doctor)</li><li>date and time when medical record was created</li><li>patient first name</li><li>patient last name</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="__question_10_ulink_url_https_www_youtube_com_watch_feature_player_embedded_amp_v_mrf_yhkceda_answer_ulink"/>1.7.8.10. [Question 10] <a class="ulink" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=MRf_YhKcEDA">Answer</a></h4></div></div></div><p><span class="strong"><strong>Understanding the output of explain</strong></span> We perform the following query on the enron dataset:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">db.messages.find({'headers.Date':{'$gt': new Date(2001,3,1)}},{'headers.From':1, _id:0}).sort({'headers.From':1}).explain()</pre><p>and get the following explain output.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="CONSOLE">{
	"cursor" : "BtreeCursor headers.From_1",
	"isMultiKey" : false,
	"n" : 83057,
	"nscannedObjects" : 120477,
	"nscanned" : 120477,
	"nscannedObjectsAllPlans" : 120581,
	"nscannedAllPlans" : 120581,
	"scanAndOrder" : false,
	"indexOnly" : false,
	"nYields" : 0,
	"nChunkSkips" : 0,
	"millis" : 250,
	"indexBounds" : {
		"headers.From" : [
			[
				{
					"$minElement" : 1
				},
				{
					"$maxElement" : 1
				}
			]
		]
	},
	"server" : "Andrews-iMac.local:27017"
}</pre><p>Check below all the statements that are true about the way MongoDB handled this query.</p><div class="itemizedlist"><ul><li>The query did not utilize an index to figure out which documents match the find criteria. <span class="strong"><strong>OK</strong></span></li><li>The query used an index for the sorting phase.  <span class="strong"><strong>OK</strong></span></li><li>The query returned 120,477 documents</li><li>The query performed a full collection scan  <span class="strong"><strong>OK</strong></span></li></ul></div></div></div></div></div></div><HR xmlns=""/><a xmlns="" href=""/></body></html>